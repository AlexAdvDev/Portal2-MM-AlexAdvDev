    //## SP_A1_INTRO2 ##//
    if (GetMapName() == "sp_a1_intro2") {
        if (MSInstantRun == true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            SendToConsole("commentary 0")
            Entities.FindByName(null, "@entry_door-door_close_relay").Destroy()
            Entities.FindByName(null, "@exit_door-door_close_relay").Destroy()
            Entities.FindByName(null, "Fizzle_Trigger").Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {

            local portalgun = null
            while (portalgun = Entities.FindByClassname(portalgun, "weapon_portalgun")) {
                portalgun.Destroy()
            }

            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-320, 1248, -656), 50)) {
                 
                SendToConsole("changelevel sp_a1_intro3")
            }

            try {
                Entities.FindByName(null, "block_boxes").Destroy()
            } catch(exception) {}
        }
    }


    //## SP_A1_INTRO3 ##//
    if (GetMapName() == "sp_a1_intro3") {

        if (MSInstantRun == true) {
            Entities.FindByName(null, "door_0-door_close_relay").Destroy()
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            Entities.FindByName(null, "player_clips").Destroy()
            // Destroy pusher x4
            Entities.FindByName(null, "podium_collapse_push_brush").Destroy()
            Entities.FindByName(null, "podium_collapse_push_brush").Destroy()
            Entities.FindByName(null, "podium_collapse_push_brush").Destroy()
            Entities.FindByName(null, "podium_collapse_push_brush").Destroy()
            Entities.FindByName(null, "door_3-door_close_relay").Destroy()
            Entities.FindByName(null, "portal_orange_2").Destroy()
            Entities.FindByName(null, "emitter_orange_2").Destroy()
            Entities.FindByName(null, "backtrack_brush").Destroy()
            Entities.FindByName(null, "portal_orange_mtg").Destroy()
            Entities.FindByName(null, "emitter_orange_mtg").Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-1344, 4304, -784), 50)) {
             
            SendToConsole("changelevel sp_a1_intro4")
            }

            try {
                EntFireByHandle(Entities.FindByName(null, "arrival_elevator-light_elevator_fill"), "TurnOn", "", 0, null, null)
            } catch(exception) {}

            // Remove Portal Gun
            if (hasgotportalgunSPMP == 0) {
                local portalgun = null
                while (portalgun = Entities.FindByClassname(portalgun, "weapon_portalgun")) {
                    portalgun.Destroy()
                }
            }

            // Make Wheatley look at nearest player
            local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
            EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)

            try {
                EntFireByHandle(Entities.FindByName(null, "arrival_elevator-light_elevator_fill"), "TurnOn", "", 0, null, null)
            } catch(exception) {}
        }
    }

    //## SP_A1_INTRO4 ##//
    if (GetMapName() == "sp_a1_intro4") {
        if (MSInstantRun == true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            Entities.FindByName(null, "door_0-door_close_relay").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(464, 136, 72), 1024).Destroy()
            EntFireByHandle(Entities.FindByName(null, "glass_pane_intact_model"), "kill", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "glass_pane_fractured_model"), "enable", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "glass_pane_1_door_1"), "open", "", 0, null, null)
            Entities.FindByName(null, "glass_pane_1_door_1_blocker").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(878, -528, 137), 1024).Destroy()
            Entities.FindByName(null, "glass_shard").Destroy()
            Entities.FindByName(null, "section_2_trigger_portal_spawn_a2_rm3a").Destroy()
            Entities.FindByName(null, "portal_a_lvl3").Destroy()
            Entities.FindByName(null, "section_2_portal_a1_rm3a").Destroy()
            Entities.FindByName(null, "section_2_portal_a2_rm3a").Destroy()
            Entities.FindByName(null, "room_1_portal_activate_rl").Destroy()
            Entities.FindByName(null, "room_2_portal_activate_rl").Destroy()
            Entities.FindByName(null, "room_3_portal_activate_rl").Destroy()
            Entities.FindByName(null, "door_2-close_door_rl").Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            try {
                EntFireByHandle(Entities.FindByName(null, "arrival_elevator-light_elevator_fill"), "TurnOn", "", 0, null, null)
            } catch(exception) {}
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(806, -528, 64), 150)) {
                EntFire("projected_texture_03", "TurnOn", "", 0, null)
            }
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(2151, -527, -499), 50)) {
                 
                SendToConsole("changelevel sp_a1_intro5")
            }
        }
    }

    //## SP_A1_INTRO5 ##//
    if (GetMapName() == "sp_a1_intro5") {
        if (MSInstantRun == true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            Entities.FindByName(null, "room_1_portal_activate_rl").Destroy()
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_multiple", Vector(-64, 824, 320), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            try {
                EntFireByHandle(Entities.FindByName(null, "arrival_elevator-light_elevator_fill"), "TurnOn", "", 0, null, null)
            } catch(exception) {}
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-67, 1319, -102), 60)) {
                 
                SendToConsole("changelevel sp_a1_intro6")
            }
        }
    }

    //## SP_A1_INTRO6 ##//
    if (GetMapName() == "sp_a1_intro6") {
        if (MSInstantRun == true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            Entities.FindByName(null, "room_1_entry_door-close_door_rl").Destroy()
            Entities.FindByName(null, "room_1_fling_portal_activate_rl").Destroy()
            Entities.FindByName(null, "fling_safety_catapult").Destroy()
            Entities.FindByName(null, "room_1_fling_portal_emitter").Destroy()
            Entities.FindByName(null, "room_2_fling_portal_activate_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(648, 0, 176), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(1200, -136, 188), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(2504, -160, 448), 1024).Destroy()
            local fallenautoportal = CreateProp("prop_dynamic", Vector(-325, 24, 0), "models/props/portal_emitter.mdl", 0)
            fallenautoportal.SetAngles(-90, 69, 0)
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            try {
                EntFireByHandle(Entities.FindByName(null, "arrival_elevator-light_elevator_fill"), "TurnOn", "", 0, null, null)
            } catch(exception) {}
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(3015, -174, -125), 60)) {
                 
                SendToConsole("changelevel sp_a1_intro7")
            }
        }
    }

    //## SP_A1_INTRO7 ##//
    if (GetMapName() == "sp_a1_intro7") {
        if (MSInstantRun == true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "room_1_portal_activate_rl").Destroy()
            Entities.FindByName(null, "InstanceAuto9-socket_trigger").Destroy()
            Entities.FindByName(null, "bts_panel_door-LR_heavydoor_close").Destroy()
            Entities.FindByName(null, "heavy_door_backtrack_clip").Destroy()
            Entities.FindByName(null, "bts_panel_door-heavydoor_open_clip").Destroy()
            Entities.FindByName(null, "transition_airlock_door_close_rl").Destroy()
            Entities.FindByName(null, "transition_trigger").Destroy()
            Entities.FindByName(null, "portal_detector").__KeyValueFromString("CheckAllIDs", "1")

            function wheatleyhitground() {
                EntFire("@sphere", "disablepickup", "", 1.05, null)
                EntFire("@sphere", "enablepickup", "", 8, null)
                EntFire("spherebot_1_top_swivel_1", "deactivate", "", 1.01, null)
            }

            function SPSkipPanel() {
                EntFire("InstanceAuto9-sphere_socket", "setanimation", "bindpose", 2.7, null)
                myexplode2 <- Entities.CreateByClassname("npc_personality_core")
                myexplode2.__KeyValueFromString("targetname", "myexplode2")
                myexplode2.SetOrigin(Vector(-822, -523, 1269))

                myexplode <- Entities.CreateByClassname("env_ar2explosion")
                myexplode.__KeyValueFromString("targetname", "myexplode")
                myexplode.__KeyValueFromString("material", "particle/particle_noisesphere")
                myexplode.SetOrigin(Vector(-822, -523, 1269))
                EntFire("myexplode", "explode", "", 2.5, null)
                EntFire("myexplode2", "explode", "", 2.5, null)
                EntFire("myexplode2", "explode", "", 3.0, null)

                Entities.FindByName(null, "@sphere").__KeyValueFromString("targetname", "@sphereDummy")
                local mysphere = Entities.FindByName(null, "@spheredummy")

                self.PrecacheSoundScript("sphere03.sp_a2_wheatley_ows01")
                self.PrecacheSoundScript("sphere03.sp_a2_wheatley_ows02")
                self.PrecacheSoundScript("sphere03.sphere_flashlight_tour67")
                self.PrecacheSoundScript("sphere03.sp_a1_wakeup_hacking09")
                self.PrecacheSoundScript("sphere03.sp_a1_wakeup_hacking12")
                self.PrecacheSoundScript("sphere03.sp_a1_wakeup_hacking10")
                self.PrecacheSoundScript("sphere03.bw_finale4_hackworked01")
                self.PrecacheSoundScript("Portal.elevator_chime")
                self.PrecacheSoundScript("sphere03.GloriousFreedom03")
                self.PrecacheSoundScript("sphere03.bw_fire_lift03")

                self.PrecacheSoundScript("sphere03.sp_a1_intro7_hoboturret01")
                self.PrecacheSoundScript("sphere03.sp_a1_intro7_hoboturret08")
                self.PrecacheSoundScript("sphere03.sp_a1_intro7_hoboturret07")
                self.PrecacheSoundScript("sphere03.sp_a1_intro7_hoboturret05")
                self.PrecacheSoundScript("sphere03.sp_a1_intro7_hoboturret06")

                EntFire("myexplode2", "addoutput", "targetname playline1", 2, null)
                EntFire("playline1", "addoutput", "targetname myexplode2", 2+ (TickSpeed * 2), null)

                EntFire("myexplode2", "addoutput", "targetname playline2", 6, null)
                EntFire("playline2", "addoutput", "targetname myexplode2", 6+ (TickSpeed * 2), null)

                EntFire("myexplode2", "addoutput", "targetname playline3", 12, null)
                EntFire("playline3", "addoutput", "targetname myexplode2", 12+ (TickSpeed * 2), null)

                EntFire("myexplode2", "addoutput", "targetname playline4", 16, null)
                EntFire("playline4", "addoutput", "targetname myexplode2", 16+ (TickSpeed * 2), null)

                EntFire("myexplode2", "addoutput", "targetname playline5", 18, null)
                EntFire("playline5", "addoutput", "targetname myexplode2", 18+ (TickSpeed * 2), null)

                EntFire("myexplode2", "addoutput", "targetname playline6", 24, null)
                EntFire("playline6", "addoutput", "targetname myexplode2", 24+ (TickSpeed * 2), null)

                EntFire("myexplode2", "addoutput", "targetname playline7", 25, null)
                EntFire("playline7", "addoutput", "targetname myexplode2", 25+ (TickSpeed * 2), null)

                EntFire("bts_panel_door-LR_heavydoor_open", "trigger", "", 25+ (TickSpeed * 2), null)

            }
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            WheatleySeq1 <- false
            // Make Wheatley look at nearest player
            local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
            EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "spherebot_1_top_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
            // Make Wheatley non stealable
            try {
            Entities.FindByName(null, "@sphere").ConnectOutput("OnPlayerPickup","disablewheatleyplayerpickup")
            Entities.FindByName(null, "@sphere").ConnectOutput("OnPlayerDrop","enablewheatleyplayerpickup")
            // Disable sentaint arm and disable pickup until spchill is over
            Entities.FindByName(null, "sphere_impact_trigger").ConnectOutput("OnStartTouch","wheatleyhitground")
            // Skip panel bit
            Entities.FindByName(null, "@plug_open_rl").ConnectOutput("OnTrigger","SPSkipPanel")
            } catch(exception) { }

            // Voice Lines
            if (Entities.FindByName(null, "playline1")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sp_a2_wheatley_ows01.wav")
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sp_a2_wheatley_ows02.wav")
                printl("Played line 1")
            }

            if (Entities.FindByName(null, "playline2")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sphere_flashlight_tour67.wav")
                printl("Played line 2")
            }

            if (Entities.FindByName(null, "playline3")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sp_a1_wakeup_hacking09.wav")
                printl("Played line 3")
            }

            if (Entities.FindByName(null, "playline4")) {
                Entities.FindByName(null, "InstanceAuto9-sphere_socket").EmitSound("vo\\wheatley\\sp_a1_wakeup_hacking12.wav")
                printl("Played line 4")
            }

            if (Entities.FindByName(null, "playline5")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sp_a1_wakeup_hacking10.wav")
                printl("Played line 5")
            }

            if (Entities.FindByName(null, "playline6")) {
                Entities.FindByName(null, "InstanceAuto9-sphere_socket").EmitSound("ambient\\alarms\\portal_elevator_chime.wav")
                printl("Played line 6")
            }

            if (Entities.FindByName(null, "playline7")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\bw_finale4_hackworked01.wav")
                printl("Played line 7")
            }

            if (Entities.FindByName(null, "playline8")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sp_a1_intro7_hoboturret01.wav")
                printl("Played line 8")
            }

            if (Entities.FindByName(null, "playline9")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sp_a1_intro7_hoboturret08.wav")
                printl("Played line 9")
            }

            if (Entities.FindByName(null, "playline10")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sp_a1_intro7_hoboturret07.wav")
                printl("Played line 10")
            }

            if (Entities.FindByName(null, "playline11")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sp_a1_intro7_hoboturret05.wav")
                printl("Played line 11")
            }

            if (Entities.FindByName(null, "playline12")) {
                Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\sp_a1_intro7_hoboturret06.wav")
                printl("Played line 12")
            }

            if (!Entities.FindByName(null, "seq1finished")) {
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1117, -416, 1280), 100)) {
                    Entities.CreateByClassname("prop_dynamic").__KeyValueFromString("targetname", "seq1finished")
                    printl("Sequence 1 done")
                    Entities.FindByName(null, "@spheredummy").EmitSound("vo\\wheatley\\gloriousfreedom03.wav")
                    EntFire("offrails_airlock_door_1_open_rl", "trigger", "", 0, null)
                }
            }

            if (!Entities.FindByName(null, "seq2finished")) {
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-2692, -404, 1280), 100)) {
                    Entities.CreateByClassname("prop_dynamic").__KeyValueFromString("targetname", "seq2finished")
                    printl("Sequence 2 done")

                    EntFire("@glados", "runscriptcode", "sp_a1_intro7_HoboTurretScene()", 0, null)

                    EntFire("myexplode2", "addoutput", "targetname playline8", 0, null)
                    EntFire("playline8", "addoutput", "targetname myexplode2", 0+ (TickSpeed * 2), null)

                    EntFire("myexplode2", "addoutput", "targetname playline9", 1.50, null)
                    EntFire("playline9", "addoutput", "targetname myexplode2", 1.50+ (TickSpeed * 2), null)

                    EntFire("myexplode2", "addoutput", "targetname playline10", 3, null)
                    EntFire("playline10", "addoutput", "targetname myexplode2", 3+ (TickSpeed * 2), null)

                    EntFire("myexplode2", "addoutput", "targetname playline11", 5, null)
                    EntFire("playline11", "addoutput", "targetname myexplode2", 5+ (TickSpeed * 2), null)

                    EntFire("myexplode2", "addoutput", "targetname playline12", 8, null)
                    EntFire("playline12", "addoutput", "targetname myexplode2", 8+ (TickSpeed * 2), null)
                }
            }

            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-2207, 384, 1280), 100)) {
                 
                SendToConsole("changelevel sp_a1_wakeup")
            }
        }
    }

    //## SP_A1_WAKEUP ##//
    if (GetMapName()=="sp_a1_wakeup") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "basement_breakers_entrance_door").Destroy()
            Entities.FindByName(null, "basement_breakers_entrance_blocker").Destroy()
            Entities.FindByName(null, "basement_breakers_entrance_blocker_trigger").Destroy()

            function elevatorrecreationsp_a1_wakeup() {
                printl("(P2:MM): Calling elevatorrecreationsp_a1_wakeup()...")
                EntFire("@sphere", "DisableMotion", "", 0, null)
                Entities.FindByName(null, "@sphere").SetOrigin(Vector(11357, -819, 161))
                // Sphere attach bs
                EntFire("@sphere", "EnableMotion", "", 0.7, null)
                EntFire("@sphere", "setparent", "core_receptacle_socket", 1.1, null)
                EntFire("@sphere", "setparentattachment", "sphere_attach", 1.5, null)
                EntFire("spark_glados_fuse_place", "SparkOnce", "", 1.5, null)
                EntFire("@sphere", "PlayAttach", "", 2, null)
                EntFire("@sphere", "AddContext", "socket_name:$socket_context", 1.5, null)
                EntFire("core_receptacle_socket", "setanimation", "attach", 2, null)

                // SpA1Wakeup viewcontrols
                SpA1WakeupViewcontrol <- Entities.CreateByClassname("point_viewcontrol_multiplayer")
                SpA1WakeupViewcontrol.__KeyValueFromString("targetname", "SpA1WakeupViewcontrol")
                SpA1WakeupViewcontrol.__KeyValueFromString("target_team", "-1")
                SpA1WakeupViewcontrol.SetOrigin(Vector(8976, 1119, -412))
                SpA1WakeupViewcontrol.SetAngles(27, -90, 0)
                EntFire("SpA1WakeupViewcontrol", "setparent", "core_receptacle_socket", 0, null)
                EntFire("SpA1WakeupViewcontrol", "enable", "", 0.8, null)
                EntFire("SpA1WakeupViewcontrol", "disable", "", 28, null)
                EntFire("TPPLAYERS1", "addoutput", "targetname TPPLAYERS2", 27.8, null)

                SpA1WakeupViewcontrol2 <- Entities.CreateByClassname("point_viewcontrol_multiplayer")
                SpA1WakeupViewcontrol2.__KeyValueFromString("targetname", "SpA1WakeupViewcontrol2")
                SpA1WakeupViewcontrol2.__KeyValueFromString("target_team", "-1")
                SpA1WakeupViewcontrol2.SetOrigin(Entities.FindByName(null, "camera_ghostAnim_2").GetOrigin())
                EntFire("SpA1WakeupViewcontrol2", "setparent", "camera_ghostAnim_2", 0.50, null)
                EntFire("SpA1WakeupViewcontrol2", "enable", "", 74, null)
                EntFire("SpA1WakeupViewcontrol2", "disable", "", 108, null)
                EntFire("TPPLAYERS2", "addoutput", "targetname TPPLAYERS3", 74, null)
                EntFire("TPPLAYERS3", "addoutput", "targetname TPPLAYERS4", 108, null)
                // Ent Fire PIT OF PAIN AND AGONY !!!!!!!

                EntFire("glados_postwake_soundscape", "Enable", "", 2, null)
                EntFire("glados_prewake_soundscape", "Disable", "", 2, null)
                EntFire("basement_breakers_platform_clipping", "Enable", "", 2, null)

                EntFire("basement_breakers_upper_blocker", "Enable", "", 2, null)
                EntFire("@sphere", "SetIdleSequence", "sphere_plug_idle_neutral", 2, null)
                EntFire("breaker_blocker_brush", "Disable", "", 2, null)
                EntFire("@sphere", "SpeakResponseConcept", "TLK_SOCKET_POWERED", 2.1, null)
                EntFire("@sphere", "PlayLock", "", 3.50, null)
                EntFire("aud_World.LightPowerOnLg", "PlaySound", "", 3.60, null)
                EntFire("breaker_elevator_spotlight_2", "TurnOn", "", 3.60, null)
                EntFire("basement_breakers_clack", "PlaySound", "", 3.60, null)
                EntFire("music_breakers_start", "PlaySound", "", 4, null)
                EntFire("basement_breakers_start", "Trigger", "", 4, null)

                Entities.CreateByClassname("prop_dynamic").__KeyValueFromString("targetname", "TPPLAYERS1DIS")
                EntFire("TPPLAYERS1DIS", "addoutput", "targetname TPPLAYERS1", 1, null)
            }

            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)

            Entities.FindByClassnameNearest("trigger_once", Vector(8032, 1216, 487), 100).Destroy()

            Entities.FindByClassnameNearest("trigger_once", Vector(6144, 3456, 904), 100).Destroy()

            Entities.FindByName(null, "do_not_touch_anything_trigger").Destroy()

            Entities.FindByName(null, "basement_breaker_room_entry_trigger").Destroy()

            Entities.FindByName(null, "basement_breakers_socket_trigger").Destroy()

            SpA1WakeupONCE1 <- true
            SpA1WakeupONCE2 <- true
            SpA1WakeupONCE3 <- true
            NOLLFIX <- true
            TPP1 <- true
            TPP2 <- true
            TPP3 <- true
            TPP4 <- true

            SpA1WakeupPostPlayerSpawn <- true

            Entities.FindByName(null, "@basement_entry_portal_black").Destroy()
            Entities.FindByClassnameNearest("func_areaportalwindow", Vector(10364, 1080, -216), 100).__KeyValueFromString("FadeStartDist", "1750")
            Entities.FindByClassnameNearest("func_areaportalwindow", Vector(10364, 1080, -216), 100).__KeyValueFromString("FadeDist", "1950")
            Entities.FindByClassnameNearest("func_areaportalwindow", Vector(10364, 1080, -216), 100).__KeyValueFromString("targetname", "incinerator_portal_custom")
        }

        if (MSPostMapSpawn==true) {
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
            SpA1WakeupPostPlayerSpawn <- false
        }

            if (MSLoop==true) {
                if (TPP1==true) {
                    if (Entities.FindByName(null, "TPPLAYERS1")) {
                        local p = null
                        while (p = Entities.FindByClassname(p, "player")) {
                            p.SetOrigin(Vector(8548, 1204, 106))
                            p.SetVelocity(Vector(0, 0, 0))
                        }
                        TPP1 <- false
                }
            }

            if (TPP2==true) {
                if (Entities.FindByName(null, "TPPLAYERS2")) {
                    local p = null
                    while (p = Entities.FindByClassname(p, "player")) {
                        p.SetOrigin(Vector(8947, 1062, 451))
                        p.SetVelocity(Vector(0, 0, 0))
                        p.SetAngles(20, 40, 0)
                    }
                    TPP2 <- false
                }
            }

            if (TPP3==true) {
                if (Entities.FindByName(null, "TPPLAYERS3")) {
                    local p = null
                    while (p = Entities.FindByClassname(p, "player")) {
                        p.SetOrigin(Vector(8548, 1204, 106))
                        p.SetVelocity(Vector(0, 0, 0))
                        p.SetAngles(20, 40, 0)
                    }
                    TPP3 <- false
                }
            }

            if (TPP4==true) {
                if (Entities.FindByName(null, "TPPLAYERS4")) {
                    local p = null
                    while (p = Entities.FindByClassname(p, "player")) {
                        p.SetOrigin(Vector(10366, 1215, 486))
                        p.SetVelocity(Vector(0, 0, 0))
                        p.SetAngles(90, 0, 0)
                    }
                    TPP4 <- false
                }
            }

                if (NOLLFIX==true) {
                    if (Entities.FindByName(null, "Startelevatorrecreationsp_a1_wakeup")) {
                        elevatorrecreationsp_a1_wakeup()
                        NOLLFIX <- false
                    }
                }

                if (SpA1WakeupONCE3 == true) {
                    local p = null
                    while (p = Entities.FindByClassnameWithin(p, "player", Vector(8976.9541015625, 1085.8822021484, -435.20544433594), 33.199999332428)) {
                        EntFire("@glados", "RunScriptCode", "sp_a1_wakeup_Do_Not_Touch()", 0, null)
                        EntFire("basement_breakers_entrance_door", "Close", "", 0, null)
                        EntFire("basement_breakers_entrance_blocker_trigger", "Enable", "", 0, null)
                        EntFire("basement_breakers_clack", "PlaySound", "", 1.60, null)

                        Entities.CreateByClassname("prop_dynamic").__KeyValueFromString("targetname", "NOLLENTITY")
                        EntFire("NOLLENTITY", "addoutput", "targetname Startelevatorrecreationsp_a1_wakeup", 25, null)
                        SpA1WakeupONCE3 <- false
                    }
                }

                if (SpA1WakeupONCE2 == true) {
                    local p = null
                    while (p = Entities.FindByClassnameWithin(p, "player", Vector(9377, 1344, -415), 33.199999332428)) {
                        EntFire("basement_breakers_prop_0", "SetAnimation", "breaker_shaft_open_hatch", 0, null)
                        EntFire("light_orange_glados", "TurnOn", "", 0, null)
                        EntFire("basement_breakers_open_wav", "PlaySound", "", 0, null)
                        EntFire("@glados", "RunScriptCode", "sp_a1_wakeup_This_Is_Breaker_Room()", 0, null)
                        EntFire("breaker_bottom_light", "TurnOn", "", 0.10, null)
                        SpA1WakeupONCE2 <- false
                    }
                }

            if (SpA1WakeupPostPlayerSpawn == true) {
                try {
                Entities.FindByName(null, "@sphere").ConnectOutput("OnPlayerPickup","disablewheatleyplayerpickup")
                Entities.FindByName(null, "@sphere").ConnectOutput("OnPlayerDrop","enablewheatleyplayerpickup")
                } catch(exception) { }

                Entities.FindByName(null, "@sphere").SetOrigin(Vector(6975, 561, 412))
            }

            // Find all players within 100 units of 8032 1216 487
            local p = null
            while (p = Entities.FindByClassnameWithin(p, "player", Vector(8032, 1216, 487), 100)) {
                if (SpA1WakeupONCE1 == true) {
                    printl("Wakeup sequence started")
                    EntFire("@glados", "runscriptcode", "sp_a1_wakeup_gantry_door_open()", 0, null)
                    EntFire("training_door", "open", "", 0, null)
                    SpA1WakeupONCE1 <- false
                }
            }

            // find all players within 100 units of 6977, 493, 572
            local p = null
            while (p = Entities.FindByClassnameWithin(p, "player", Vector(6976, 568, 521), 225)) {
                if (p.GetOrigin().z >= 450) {
                    printl("Player is in the elevator")
                    if (p.GetTeam()==2) {
                        p.SetOrigin(Vector(6926, 398, 410))
                    } else {
                        p.SetOrigin(Vector(7026, 398, 410))
                    }
                    p.SetAngles(5, 90, 0)
                }
            }

            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(6144, 3456, 904), 120)) {
                 
                SendToConsole("changelevel sp_a2_intro")
            }
        }
    }

    //## SP_A2_INTRO ##//
    if (GetMapName()=="sp_a2_intro") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "incinerator_death_fade").Destroy()
            Entities.FindByName(null, "camera_ghostAnim").Destroy()
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "incinerator_window_brush").Destroy()
            Entities.FindByName(null, "incinerator_portal").__KeyValueFromString("FadeStartDist", "1750")
            Entities.FindByName(null, "incinerator_portal").__KeyValueFromString("FadeDist", "1950")
            Entities.FindByName(null, "incinerator_portal").__KeyValueFromString("targetname", "incinerator_portal_custom")
            EntFire("@enable_arms", "trigger", "", 0, null)
            Entities.FindByName(null, "InstanceAuto13-dangle_ceiling-disable_arms").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(2704, -1260, 112), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            printl("Ran")
            SpA2IntroViewcontrol <- Entities.CreateByClassname("point_viewcontrol_multiplayer")
            SpA2IntroViewcontrol.__KeyValueFromString("targetname", "SpA2IntroViewcontrol")
            SpA2IntroViewcontrol.__KeyValueFromString("target_team", "-1")
            SpA2IntroViewcontrol.SetOrigin(Entities.FindByName(null, "ghostAnim").GetOrigin())
            EntFire("SpA2IntroViewcontrol", "setparent", "ghostAnim", 0, null)
            EntFire("SpA2IntroViewcontrol", "setparentattachment", "attach_1", 0, null)
            EntFire("SpA2IntroViewcontrol", "enable", "", 0, null)
            EntFire("SpA2IntroViewcontrolTele", "disable", "", 20.75, null)
            EntFire("SpA2IntroViewcontrol", "addoutput", "targetname SpA2IntroViewcontrolTele", 0.25, null)
            EntFire("SpA2IntroViewcontrolTele", "addoutput", "targetname SpA2IntroViewcontrolDone", 20.80, null)
            self.PrecacheSoundScript("ScriptedSequence.IncineratorFall")
            local TempEnt = Entities.CreateByClassname("prop_dynamic")
            TempEnt.__KeyValueFromString("targetname", "TempEnt")
            EntFire("TempEnt", "addoutput", "targetname PlayFallSound", 0, null)
            EntFire("PlayFallSound", "kill", "", 0 + (TickSpeed * 2), null)
        }

        if (MSLoop==true) {

            if (Entities.FindByName(null, "PlayFallSound")) {
            Entities.FindByName(null, "blue").EmitSound("playonce\\scripted_sequences\\incinerator_fall_01.wav")
            }

            if (Entities.FindByName(null, "SpA2IntroViewcontrolTele")) {
                local p = null
                while (p = Entities.FindByClassname(p, "player")) {
                    p.SetOrigin(Vector(2704, -1260, 92))
                }
            }

            if (Entities.FindByName(null, "SpA2IntroViewcontrolDone")) {
                local p = null
                while (p = Entities.FindByClassname(p, "player")) {
                    p.SetOrigin(Vector(-3308, 536, -10737))
                    p.SetAngles(0 0 0)
                }
                EntFire("SpA2IntroViewcontrolDone", "addoutput", "targetname SpA2IntroViewcontrolFinished", 0.15, null)
            }

            EntFire("shaft_areaportal_1", "open", "", 0, null)
            EntFire("shaft_areaportal_2", "open", "", 0, null)

            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-736, 1594, -11038), 50)) {
                 
                SendToConsole("changelevel sp_a2_laser_intro")
            }

            // Remove the player's Portal Gun
            if (Entities.FindByName(null, "portalgun")) {
                local ent = null
                while (ent = Entities.FindByClassname(ent, "weapon_portalgun")) {
                    ent.Destroy()
                }
            }

            // Give the player a Portal Gun
            if (!Entities.FindByName(null, "portalgun")) {
                local p = null
                while (p = Entities.FindByClassname(p, "player")) {
                    if (Entities.FindByName(null, "CustomPortalGun")) {
                    } else {
                        PortalGunGiveContinue <- true
                        local ent = null
                        while (ent = Entities.FindByClassnameWithin(ent, "weapon_portalgun", p.GetOrigin(), 2)) {
                            PortalGunGiveContinue <- false
                        }
                        if (PortalGunGiveContinue==true) {
                        PortalGun <- Entities.CreateByClassname("weapon_portalgun")
                        PortalGun.__KeyValueFromString("StartingTeamNum", "0")
                        PortalGun.__KeyValueFromString("targetname", "CustomPortalGun")
                        PortalGun.SetOrigin(Vector(p.GetOrigin().x, p.GetOrigin().y, p.GetOrigin().z+20))
                        EntFireByHandle(PortalGun, "use", "", 0.25, p, p)
                        EntFireByHandle(PortalGun, "kill", "", 1.25, p, p)
                        }
                    }
                }
            }
        }
    }

    //## SP_A2_LASER_INTRO ##//
    if (GetMapName() == "sp_a2_laser_intro") {
        if (MSInstantRun == true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(712, 0, 0), 100).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(816, 0, -8), 100).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1224, 8, -590), 50)) {
                 
                SendToConsole("changelevel sp_a2_laser_stairs")
            }
        }
    }

    //## SP_A2_LASER_STAIRS ##//
    if (GetMapName() == "sp_a2_laser_stairs") {
        if (MSInstantRun == true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_multiple", Vector(144, 600, 94.82), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(144, 704, 72), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(148, 1126, -396), 50)) {
                 
                SendToConsole("changelevel sp_a2_dual_lasers")
            }
        }
    }

    //## SP_A2_DUAL_LASERS ##//
    if (GetMapName()=="sp_a2_dual_lasers") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(640, 224, 936), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_multiple", Vector(488, 216, 960), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Make Wheatley look at nearest player
            local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
            EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)

            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1063, 210, 277), 50)) {
                 
                SendToConsole("changelevel sp_a2_laser_over_goo")
            }
        }
    }

    //## SP_A2_LASER_OVER_GOO ##//
    if (GetMapName()=="sp_a2_laser_over_goo") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            Entities.FindByName(null, "@repair_wall_kill_all").Destroy()
            Entities.FindByName(null, "door_1-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(2552, -1056, 142.82), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(2432, -1056, 72), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(2008, -1055, -328), 50)) {
                 
                SendToConsole("changelevel sp_a2_catapult_intro")
            }


        }
    }

    //## SP_A2_CATAPULT_INTRO ##//
    if (GetMapName()=="sp_a2_catapult_intro") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_1-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-56, -1576, -384), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-64, -1696, -408), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-80, -2106, -805), 50)) {
                 
                SendToConsole("changelevel sp_a2_trust_fling")
            }


        }
    }
    //## SP_A2_TRUST_FLING ##//
    if (GetMapName()=="sp_a2_trust_fling") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-1152, 1616, 120), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-1152, 1680, 40), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-1151, 2087, -319), 50)) {
                 
                SendToConsole("changelevel sp_a2_pit_flings")
            }


        }
    }

    //## SP_A2_PIT_FLINGS ##//
    if (GetMapName()=="sp_a2_pit_flings") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "walltunnel_1_Cover_clip").Destroy()
            Entities.FindByName(null, "exit_door_lock_counter").Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Cube ramp disabler
            local ent = null
            while (ent = Entities.FindByClassnameWithin(ent, "prop_weighted_cube", Vector(-448, -416, -104), 32)) {
                try {
                    Entities.FindByName(null, "ramp_90deg_02-ramp_close").Destroy()
                    Entities.FindByName(null, "ramp_90deg_04-ramp_close").Destroy()
                } catch(exception) { }
            }

            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-893, 1223, -362), 50)) {
                 
                SendToConsole("changelevel sp_a2_fizzler_intro")
            }


        }
    }

    //## SP_A2_FIZZLER_INTRO ##//
    if (GetMapName()=="sp_a2_fizzler_intro") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(872, -64, -8), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(928, -64, -24), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1351, -71, -503), 50)) {
                 
                SendToConsole("changelevel sp_a2_sphere_peek")
            }


        }
    }

    //## SP_A2_SPHERE_PEEK ##//
    if (GetMapName()=="sp_a2_sphere_peek") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-544, 1096, 464), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-544, 992, 488), 1024).Destroy()
            Cardio <- true
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            local p = null
            while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1259.1446533203, 1557.3728027344, 455.14566040039), 280)) {
                Cardio <- false
            }

            // Find every player within 600 units of -1953 1570 575
            if (Cardio == true) {
                local p = null
                while(p = Entities.FindByClassnameWithin(p, "player", Vector(-1953, 1570, 575), 600)) {
                    local p2 = Entities.FindByClassnameNearest("player", Vector(-1953, 1570, 575), 10620)
                    if (p != p2) {
                        p.SetOrigin(Vector(-2230, 1725, -90))
                        p.SetVelocity(Vector(0, 0, 0))
                    }
                }
            }
            // Make Wheatley look at nearest player
            local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
            EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-544, 573, 154), 50)) {
                 
                SendToConsole("changelevel sp_a2_ricochet")
            }
        }
    }

    //## SP_A2_RICOCHET ##//
    if (GetMapName()=="sp_a2_ricochet") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(4008, 1152, -456), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(4064, 1152, -472), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(4478, 1158, -774), 50)) {
                 
                SendToConsole("changelevel sp_a2_bridge_intro")
            }
        }
    }

    //## SP_A2_BRIDGE_INTRO ##//
    if (GetMapName()=="sp_a2_bridge_intro") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_52-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(0, 760, 56), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(0, 832, 40), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Make Wheatley look at nearest player
            local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
            EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)

            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(0, 1255, -297), 50)) {
                 
                SendToConsole("changelevel sp_a2_bridge_the_gap")
            }
        }
    }

    //## SP_A2_BRIDGE_THE_GAP ##//
    if (GetMapName()=="sp_a2_bridge_the_gap") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy beginning door triggers
            Entities.FindByClassnameNearest("trigger_once", Vector(-1296, -640, 1280), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-496, -640, 1216), 1024).Destroy()
            // Destroy objects
            Entities.FindByClassnameNearest("trigger_once", Vector(320, 624, 960), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(320, 960, 936), 1024).Destroy()
            // Fix func_portal_detectors
            local ent = null
            while (ent = Entities.FindByClassname(ent, "func_portal_detector")) {
                ent.__KeyValueFromString("CheckAllIDs", "1")
            }
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Make Wheatley look at nearest player
            local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "@sphere_bottom_swivel_1").GetOrigin(), 10000)
            EntFireByHandle(Entities.FindByName(null, "@sphere_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)

            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(321, 1374, 561), 50)) {
                 
                SendToConsole("changelevel sp_a2_turret_intro")
            }
        }
    }

    //## SP_A2_TURRET_INTRO ##//
    if (GetMapName()=="sp_a2_turret_intro") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            //Kill the last door close trigger
            Entities.FindByClassnameNearest("trigger_multiple", Vector(-174.19, 392.03, -160), 1024).Destroy()
            //Kill the changelevel trigger
            Entities.FindByName(null, "transition_trigger").Destroy()
            // Set the door logic
            TurretIntroOpenDoor <- false
            TurretIntroDoorOpened <- false
            Entities.FindByName(null, "@exit_door-testchamber_door").__KeyValueFromString("targetname", "MpModDoorOverride")
            Entities.FindByName(null, "@exit_door-door_player_clip").__KeyValueFromString("targetname", "MpModDoorClipOverride")
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Find all prop_weighted_cube entities within 24 units of 704, -512 16
            TurretIntroOpenDoor <- false
            local ent = null
            while (ent = Entities.FindByClassnameWithin(ent, "prop_weighted_cube", Vector(704, -512, 8, 24), 28)) {
                TurretIntroOpenDoor <- true
            }

            local ent = null
            while (ent = Entities.FindByClassnameWithin(ent, "player", Vector(704, -512, 8, 24), 24)) {
                TurretIntroOpenDoor <- true
            }

            if (TurretIntroOpenDoor==true) {
                if (TurretIntroDoorOpened==false) {
                    // Open the door
                    EntFireByHandle(Entities.FindByName(null, "MpModDoorOverride"), "open", "", 0, null, null)
                    EntFireByHandle(Entities.FindByName(null, "MpModDoorClipOverride"), "disable", "", 0, null, null)
                    TurretIntroDoorOpened <- true
                }
            } else {
                if (TurretIntroDoorOpened==true) {
                    EntFireByHandle(Entities.FindByName(null, "MpModDoorOverride"), "close", "", 0, null, null)
                    EntFireByHandle(Entities.FindByName(null, "MpModDoorClipOverride"), "enable", "", 0, null, null)
                    TurretIntroDoorOpened <- false
                }
            }

            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-452, 196, -292), 200)) {
                 
                SendToConsole("changelevel sp_a2_laser_relays")
            }
        }
    }

    //## SP_A2_LASER_RELAYS ##//
    if (GetMapName()=="sp_a2_laser_relays") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Kill the beginning door close trigger
            Entities.FindByClassnameNearest("trigger_once", Vector(1224, -704, 32), 1024).Destroy()
            // Kill the panels' relays
            Entities.FindByName(null, "animset01_kill_rl").Destroy()
            Entities.FindByName(null, "animset02_kill_rl").Destroy()
            Entities.FindByName(null, "animset03_kill_rl").Destroy()
            Entities.FindByName(null, "animset04_kill_rl").Destroy()
            Entities.FindByName(null, "animset05_kill_rl").Destroy()
            Entities.FindByName(null, "animset06_kill_rl").Destroy()
            Entities.FindByName(null, "animset07_kill_rl").Destroy()
            Entities.FindByName(null, "animset08_kill_rl").Destroy()
            Entities.FindByName(null, "lift_kill_rl").Destroy()
            // Kill the end door close trigger even though it probably isn't linked to the door relay
            Entities.FindByClassnameNearest("trigger_once", Vector(-320, -1376, 40), 1024).Destroy()
            SingleplayerOneTimeTrigger1 <- true
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSOnPlayerJoin==true) {
            // Find all players
            local p = null
            while (p = Entities.FindByClassname(p, "player")) {
                EntFireByHandle(clientcommand, "Command", "r_flashlightbrightness 1", 0, p, p)
                EntFireByHandle(p, "setfogcontroller", "@environment_mines_fog", 0, null, null)
            }
        }

        if (MSLoop==true) {
            if (SingleplayerOneTimeTrigger1 == true) {
                if (!Entities.FindByClassnameNearest("trigger_once", Vector(-468, -704, -63), 10)) {
                    // Find all players
                    local p = null
                    while(p = Entities.FindByClassname(p, "player")) {
                        // Teleport them to the elevator
                        p.SetOrigin(Vector(-449, -704, -55))
                        p.SetAngles(0, 0, 0)
                        p.SetVelocity(Vector(0, 0, 0))
                    }
                    Entities.CreateByClassname("prop_dynamic").__KeyValueFromString("targetname", "TPUpLaserRelaysDIS")
                    EntFire("TPUpLaserRelaysDIS", "addoutput", "targetname TPUpLaserRelays", 12, null)
                    SingleplayerOneTimeTrigger1 <- false
                }
            }

            if (Entities.FindByName(null, "TPUpLaserRelays")) {
                local p = null
                while(p = Entities.FindByClassname(p, "player")) {
                    SKIPLaserRelays <- false
                    local p2 = null
                    while (p2 = Entities.FindByClassnameWithin(p2, "player", Vector(-319.15093994141, -1782.7447509766, -17.6354637146), 380.50416564941)) {
                        if (p2==p) {
                            SKIPLaserRelays <- true
                        }
                    }
                    if (SKIPLaserRelays == false) {
                        if (p.GetOrigin().z <= -50) {
                            p.SetOrigin(Vector(-256, -189, 28))
                            p.SetAngles(0, -90, 0)
                            p.SetVelocity(Vector(0, 0, 0))
                        }
                    }
                }
            }

            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-318, -1790, -267), 50)) {
                // Reset r_flashlightbrightness
                local p = null
                while (p = Entities.FindByClassname(p, "player")) {
                    EntFireByHandle(clientcommand, "Command", "r_flashlightbrightness 0.25", 0, p, p)
                }
                 
                SendToConsole("changelevel sp_a2_turret_blocker")
            }
        }
    }

    //## SP_A2_TURRET_BLOCKER ##//
    if (GetMapName()=="sp_a2_turret_blocker") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "blast_door").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(64, 1704, 64), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(64, 1776, 40), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

            if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(63, 2185, -265), 50)) {
                 
                SendToConsole("changelevel sp_a2_laser_vs_turret")
            }
        }
    }

    //## SP_A2_LASER_VS_TURRET ##//
    if (GetMapName()=="sp_a2_laser_vs_turret") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-631, 377, 322), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-672, 384, 296), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-1075, 382, -8), 50)) {
                 
                SendToConsole("changelevel sp_a2_pull_the_rug")
            }


        }
    }

    //## SP_A2_PULL_THE_RUG ##//
    if (GetMapName()=="sp_a2_pull_the_rug") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "prevent_ratman_backtrack").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(64, 896, 104), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(64, 888, 96), 1024).Destroy()
            Entities.FindByClassnameNearest("prop_dynamic", Vector(80, -755, 256), 1024).SetOrigin(Vector(72, -777, 192))
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(64, 1311, -200), 50)) {
                 
                SendToConsole("changelevel sp_a2_column_blocker")
            }
        }
    }

    //## SP_A2_COLUMN_BLOCKER ##//
    if (GetMapName()=="sp_a2_column_blocker") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            // Kill the point_teleport so we aren't teleporting 33 players to the exact same place
            Entities.FindByName(null, "blackout_teleport_player_to_surprise").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-976, 256, 32), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-1056, 256, 40.25), 1024).Destroy()
            OnlyOnceSpA2ColumBlocker1 <- true
            OnlyOnceSpA2ColumBlocker2 <- true
            OnlyOnceSpA2ColumBlocker3 <- true
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
            Entities.FindByClassnameNearest("trigger_once", Vector(-1394, 108, -1906), 1024).__KeyValueFromString("spawnflags", "4161")
            Entities.FindByClassnameNearest("trigger_once", Vector(-1472, 256, -2591.75), 1024).__KeyValueFromString("spawnflags", "4161")
        }

        if (MSLoop==true) {
            if (OnlyOnceSpA2ColumBlocker3==true) {
                if (!Entities.FindByClassnameNearest("trigger_once", Vector(-1486, 256, -139.75), 10)) {
                    printl("(P2:MM): Elevator viewcontrol activated!")
                    // Elevator viewcontrol
                    SpA2ColumBlockerViewcontrol <- Entities.CreateByClassname("point_viewcontrol_multiplayer")
                    SpA2ColumBlockerViewcontrol.__KeyValueFromString("target_team", "-1")
                    SpA2ColumBlockerViewcontrol.__KeyValueFromString("fov", "100")
                    SpA2ColumBlockerViewcontrol.__KeyValueFromString("targetname", "SpA2ColumBlockerViewcontrol")
                    SpA2ColumBlockerViewcontrol.SetOrigin(Vector(-1475, 256, -90))
                    EntFire("SpA2ColumBlockerViewcontrol", "setparent", "departure_elevator-elevator_1", 0, null)
                    SpA2ColumBlockerViewcontrol.SetAngles(0, 0, 0)
                    EntFire("SpA2ColumBlockerViewcontrol", "enable", "", 0, null)

                    EntFireByHandle(Entities.FindByName(null, "departure_elevator-spherebot_1_bottom_swivel_1"), "SetTargetEntity", "SpA2ColumBlockerViewcontrol", 0, null, null)

                    EntFire("global_ents-proxy", "OnProxyRelay2", "", 6.2, null)
                    EntFire("departure_elevator-bts_shadowed_light_01", "TurnOn", "", 6.2, null)
                    EntFire("departure_elevator-elevator_1", "SetSpeedReal", "50", 6.2, null)

                    OnlyOnceSpA2ColumBlockerGlobalTime <- 9
                    Entities.CreateByClassname("point_servercommand").__KeyValueFromString("targetname", "SpA2ColumBlockerCommand")
                    EntFire("@sphere", "RunScriptCode", "ElevatorThereYouAre()", OnlyOnceSpA2ColumBlockerGlobalTime, null)
                    EntFire("departure_elevator-//spherebot_train_1_chassis_1", "MoveToPathNode", "spherebot_train_1_path_2", OnlyOnceSpA2ColumBlockerGlobalTime, null)
                    EntFire("ColumServerCommand", "command", "echo Changing level...", OnlyOnceSpA2ColumBlockerGlobalTime + 29, null)
                    EntFire("ColumServerCommand", "command", "changelevel sp_a2_laser_chaining", OnlyOnceSpA2ColumBlockerGlobalTime + 29, null)

                    local p = null
                    while (p = Entities.FindByClassname(p, "player")) {
                        p.SetOrigin(Vector(-1964, 331, -2479))
                    }

                    OnlyOnceSpA2ColumBlocker3 <- false
                }
            }

            // Delete office door after walking through it
            if (OnlyOnceSpA2ColumBlocker2==true) {
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-63, -780, 320), 40)) {
                    Entities.FindByName(null, "officedoor_1").Destroy()
                    OnlyOnceSpA2ColumBlocker2 <- false
                }
            }

            // Teleport players after blackout
            if (OnlyOnceSpA2ColumBlocker1==true) {
                if (!Entities.FindByClassnameNearest("trigger_once", Vector(-76, -1040, 311.5), 3)) {
                    // Find all players
                    local p = null
                    while (p = Entities.FindByClassname(p, "player")) {
                        p.SetOrigin(Vector(-64, -1088, 256))
                        p.SetAngles(0, 90, 0)
                    }
                    OnlyOnceSpA2ColumBlocker1 <- false
                }
            }

            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-1469, 265, -2870), 50)) {
                 
                SendToConsole("changelevel sp_a2_laser_chaining")
            }
        }
    }

    //## SP_A2_LASER_CHAINING ##//
    if (GetMapName()=="sp_a2_laser_chaining") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(1048, 352, 320), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(1088, 352, 296), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1500, 352, -13), 50)) {
                 
                SendToConsole("changelevel sp_a2_triple_laser")
            }
        }
    }

    //## SP_A2_TRIPLE_LASER ##//
    if (GetMapName()=="sp_a2_triple_laser") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            // We should do something sussy in this map, probably something the observation room (Kinda Moja)
            Entities.FindByClassnameNearest("trigger_once", Vector(6984, -5376, 40), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(6912, -5376, 40), 1024).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(6494, -5376, -273), 50)) {
                 
                SendToConsole("changelevel sp_a2_bts1")
            }

            // Elevator env_projectedtexture
            try {
                EntFireByHandle(Entities.FindByName(null, "arrival_elevator-light_elevator_fill"), "TurnOn", "", 0, null, null)
            } catch(exception) {}
        }
    }

    //## SP_A2_BTS1 ##//
    if (GetMapName()=="sp_a2_bts1") {
        if (MSInstantRun==true) {
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "startforward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "chamber_door-close_door_rl").Destroy()
            Entities.FindByName(null, "jailbreak_chamber_unlit-toxin_death_fade").Destroy()
            Entities.FindByName(null, "jailbreak_chamber_unlit-toxin_death_trigger").Destroy()
            Entities.FindByName(null, "pre_solved_chamber-toxin_kill_trigger").__KeyValueFromString("damage", "15")
            Entities.FindByName(null, "pre_solved_chamber-toxin_kill_trigger").__KeyValueFromString("damagecap", "15")
            Entities.FindByName(null, "pre_solved_chamber-toxin_fade").Destroy()
            Entities.FindByName(null, "pre_solved_chamber-jailbreak_wall_row_5_close_logic").Destroy()
            Entities.FindByName(null, "pre_solved_chamber-jailbreak_wall_row_6_close_logic").Destroy()
            Entities.FindByName(null, "transition_trigger").Destroy()

            Entities.FindByClassnameNearest("trigger_once", Vector(-2816, -1576, 32), 1024).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(864, -1488, -16), 1024).Destroy()

            Entities.FindByName(null, "pre_solved_chamber-chamber_bridge").__KeyValueFromString("targetname", "MPModBridgeOverride")
            EntFire("MPModBridgeOverride", "enable", "", 3, null)

            OnceTwiceSp_A2_Bts1 <- true
            OneTimeRunSp_A2_Bts1 <- true
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Bridge drop trigger
            if (OnceTwiceSp_A2_Bts1==true) {
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(836.91394042969, -1589.0966796875, -30.565340042114), 104.79999542236)) {
                    EntFire("@glados", "RunScriptCode", "JailbreakBridgeDisappear()", 0, null)
                    EntFire("MPModBridgeOverride", "disable", "", 0, null)
                    OnceTwiceSp_A2_Bts1 <- false
                }
            }

            // Exit Test Trigger
            if (OneTimeRunSp_A2_Bts1==true) {
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-3004.51953125, -1652.0881347656, 58.625823974609), 72.800002098083)) {
                    EntFire("jailbreak_chamber_unlit-jailbreak_flashlight", "TurnOff", "", 1, null)
                    EntFire("@sphere", "DisableFlashlight", "", 0, null)
                    EntFire("@glados", "RunScriptCode", "JailbreakWheatleyCloseChamber()", 0, null)
                    OneTimeRunSp_A2_Bts1 <- false
                }
            }

            // Make Wheatley look at nearest player
            try {
                local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
                EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
            } catch(exception) {}

            // Teleport bois to spawn
            if (Entities.FindByName(null, "jailbreak_chamber_lit-jailbreak_trigger")) {
                local p = null
                while(p = Entities.FindByClassnameWithin(p, "player", Vector(-3792, -1128, 142), 350)) {
                    if (p.GetTeam()==2) {
                        p.SetOrigin(Vector(-10066, -2281, 0))
                    } else {
                        p.SetOrigin(Vector(-10066, -2581, 0))
                    }
                }
            } else {
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-9915.5029296875, -2433.4301757812, -34.047546386719), 369.50420379639)) {
                    p.SetOrigin(Vector(-3482.0803222656, -2117.7331542969, 20.649803161621))
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-9241.060546875, -2418.1635742188, 104.73459625244), 200)) {
                    p.SetOrigin(Vector(-3481.3332519531, -2119.4982910156, 20.3405418396))
                }
            }

            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1253.4089355469, -1319.4395751953, -320.2317199707), 104.79999542236)) {
                 
                SendToConsole("changelevel sp_a2_bts2")
            }
        }
    }

    //## SP_A2_BTS2 ##//
    if (GetMapName()=="sp_a2_bts2") {
        if (MSInstantRun==true) {
            // Here if we need to ent_fire something
            //EntFireByHandle(Entities.FindByName(null, "NAME"), "ACTION", "VALUE", DELAYiny, ACTIVATOR, CALLER)
            // Destroy objects
            Entities.FindByName(null, "player_clip").Destroy()
            Entities.FindByName(null, "player_died_relay").Destroy()
            Entities.FindByName(null, "transition_trigger").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(1332, -250, 296), 100).__KeyValueFromString("targetname", "StartDeathEventMPMod")
            Entities.FindByClassnameNearest("trigger_once", Vector(2208, 1468, 304), 100).__KeyValueFromString("targetname", "EndDeathEventMPMod")
            Entities.FindByName(null, "pillar_fx_D_start_rl").Destroy()
            Entities.FindByName(null, "container_1_catwalk_hurt_1_rl").Destroy()
            Entities.FindByName(null, "catwalk_fx_E_1").__KeyValueFromString("targetname", "my mom")
            Entities.FindByName(null, "container_1_catwalk_hurt_2_floor").__KeyValueFromString("targetname", "my dad")
            OnlyOnceSp_A2_Bts2 <- true
            PreviousTimeSp_A2_Bts2 <- 0
            PreviousTimeSp_A2_Bts2Again <- 0
            NoPlayerMadeItOnlyOnceSp_A2_Bts2 <- true
            OnlyOnceSp_A2_Bts2AgainV2 <- true
            WheatleyPlayerLookSP_A2_BTS2 <- true
            DisableLookDisablerSP_A2_BTS2 <- false
        }

        if (MSPostPlayerSpawn==true) {
            local ent = null
            while (ent = Entities.FindByModel(ent, "models/anim_wp/room_transform/arm_exterior.mdl")) {
                EntFireByHandle(ent, "setanimation", "block_upper01_drop_idle", 0, null, null)
                ent.__KeyValueFromString("DefaultAnim", "block_upper01_drop_idle")
                local ent2 = null
                while (ent2 = Entities.FindByClassnameWithin(ent2, "prop_dynamic", Vector(1490, -4311, 128), 300)) {
                    if (ent == ent2) {
                        ent2.Destroy()
                    }
                }
            }
        }

        if (MSLoop==true) {
            local p = null
            while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1689.0235595703, -7900.8461914062, 6707.0034179688), 78.400001525879)) {
                DisableLookDisablerSP_A2_BTS2 <- true
            }

            if (DisableLookDisablerSP_A2_BTS2 == false) {
                // Make a custom trigger to disable player look
                WheatleyPlayerLookSP_A2_BTS2 <- true
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1028.5295410156, -7103.0068359375, 6741.3315429688), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1028.5295410156, -7103.0068359375, 6741.3315429688), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1028.5295410156, -7103.0068359375, 6741.3315429688), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1403.9912109375, -7096.8754882812, 6690.7314453125), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1403.9912109375, -7096.8754882812, 6690.7314453125), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1403.9912109375, -7096.8754882812, 6690.7314453125), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1789.1419677734, -7122.5893554688, 6749.4721679688), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1789.1419677734, -7122.5893554688, 6749.4721679688), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1789.1419677734, -7122.5893554688, 6749.4721679688), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1788.701171875, -7474.5654296875, 6731.2202148438), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1788.701171875, -7474.5654296875, 6731.2202148438), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1788.701171875, -7474.5654296875, 6731.2202148438), 163.19999694824)) {
                    WheatleyPlayerLookSP_A2_BTS2 <- false
                }
            }

            // if a player made it teleport everyone into the elevator
            local p = null
            while (p = Entities.FindByClassnameWithin(p, "player", Vector(2207.8967285156, 1452.6505126953, 264.08181762695), 40)) {
                if (OnlyOnceSp_A2_Bts2AgainV2==true) {
                    local p = null
                    while (p = Entities.FindByClassname(p, "player")) {
                        p.SetOrigin(Vector(2202, 1454, 303))
                        p.SetAngles(0, -90, 0)
                        p.SetVelocity(Vector(0, 0, 0))
                    }
                    OnlyOnceSp_A2_Bts2AgainV2 <- false
                }
            }

            // if no player made it, show a message and restart the level
            if (!Entities.FindByName(null, "StartDeathEventMPMod")) {
                if (OnlyOnceSp_A2_Bts2 == true) {
                    PreviousTimeSP_A2_BTS2 <- Time()
                    OnlyOnceSp_A2_Bts2 <- false
                }
                if (PreviousTimeSP_A2_BTS2 + 31 <= Time()) {
                    if (Entities.FindByName(null, "EndDeathEventMPMod")) {
                        if (NoPlayerMadeItOnlyOnceSp_A2_Bts2 == true) {
                            printl("No Player Made It")
                            PreviousTimeSP_A2_BTS2Again <- Time()
                            onscreendisplay.__KeyValueFromString("message", "Nobody Escaped...")
                            onscreendisplay.__KeyValueFromString("holdtime", "3")
                            onscreendisplay.__KeyValueFromString("fadeout", "2")
                            onscreendisplay.__KeyValueFromString("fadein", "1.25")
                            onscreendisplay.__KeyValueFromString("spawnflags", "1")
                            onscreendisplay.__KeyValueFromString("color", "230 30 30")
                            onscreendisplay.__KeyValueFromString("channel", "1")
                            onscreendisplay.__KeyValueFromString("x", "0.425")
                            onscreendisplay.__KeyValueFromString("y", "-0.2")

                            local envfade = Entities.CreateByClassname("env_fade")
                            envfade.__KeyValueFromString("duration", "5")
                            envfade.__KeyValueFromString("holdtime", "10")
                            envfade.__KeyValueFromString("ReverseFadeDuration", "0")
                            envfade.__KeyValueFromString("rendercolor", "0 0 0")
                            envfade.__KeyValueFromString("renderamt", "255")
                            envfade.__KeyValueFromString("targetname", "FadeyBoi")
                            DoEntFire("p2mm_wait_for_players_text", "display", "", 0.0, null, null)
                            DoEntFire("FadeyBoi", "fade", "", 0.0, null, null)
                            NoPlayerMadeItOnlyOnceSp_A2_Bts2 <- false
                        }

                        if (PreviousTimeSp_A2_Bts2Again + 6.75 <= Time()) {
                             
                            SendToConsole("changelevel sp_a2_bts2")
                        }
                    }
                }
            }


            // Make Wheatley look at nearest player
            if (WheatleyPlayerLookSP_A2_BTS2==true) {
                try {
                    local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
                    EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
                } catch(exception) {}
            }

            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(2207, 1983, 689), 150)) {
                 
                SendToConsole("changelevel sp_a2_bts3")
            }

            // Fix the player's spawn position
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(825, -3756, 240), 25)) {
                p.SetOrigin(Vector(772, -3780, 64))
                p.SetAngles(0, -90, 0)
                p.SetVelocity(Vector(0, -90, 0))
            }
        }
    }

    //## SP_A2_BTS3 ##//
    if (GetMapName()=="sp_a2_bts3") {
        if (MSInstantRun==true) {
            // Destroy objects
            Entities.FindByName(null, "death_fade").Destroy()
            Entities.FindByName(null, "death_fade").Destroy()
            Entities.FindByName(null, "death_fade").Destroy()
            Entities.FindByName(null, "blackout_teleport_player_to_wheatley").Destroy()
            Entities.FindByName(null, "laser_cutter_room_kill_relay").Destroy()
            Entities.FindByName(null, "fizzle_backtrack_trigger").Destroy()
            Entities.FindByName(null, "backtrack_portal_blocker").Destroy()
            Entities.FindByName(null, "backtrack_fun_preventer").Destroy()
            Entities.FindByName(null, "tube_scanner_room-shutdown_tube_objects").Destroy()
            Entities.FindByClassnameNearest("logic_auto", Vector(4231, 990, 194), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(5952, 4624, -1736), 20).Destroy()
            // Set func_portal_detector to detect all portals
            Entities.FindByName(null, "blindness_detector").__KeyValueFromString("CheckAllIDs", "1")
        }

        if (MSPostPlayerSpawn==true) {
            EntFireByHandle(Entities.FindByName(null, "entry_canyon_global_impact_sound"), "PlaySound", "", 1.8, null, null)
            EntFireByHandle(Entities.FindByName(null, "entry_canyon_shake"), "StartShake", "", 1.8, null, null)
            EntFireByHandle(Entities.FindByName(null, "security_door_2_door_spark_1"), "StartSpark", "", 3, null, null)
            EntFireByHandle(Entities.FindByName(null, "entry_airlock_door-proxy"), "OnProxyRelay7", "", 3, null, null)
            EntFireByHandle(Entities.FindByName(null, "entry_container_impact_relay"), "Trigger", "", 5, null, null)
        }

        if (MSLoop==true) {
            // Make Wheatley look at nearest player (We need wheatley to light the way for the player but since he's looking at them on loop he can't) (Moja)
            try {
                local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
                EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
            } catch(exception) {}

            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(5952, 4624, -1736), 100)) {
                 
                SendToConsole("changelevel sp_a2_bts4")
            }
        }
    }

    //## SP_A2_BTS4 ##//
    if (GetMapName()=="sp_a2_bts4") {
        if (MSInstantRun==true) {
            // Here if we need to ent_fire something
            //EntFireByHandle(Entities.FindByName(null, "NAME"), "ACTION", "VALUE", DELAYiny, ACTIVATOR, CALLER)
            // Destroy objects
            Entities.FindByName(null, "canyon_death_fade").Destroy()
            Entities.FindByName(null, "death_fade").Destroy()
            Entities.FindByName(null, "gib_conveyor_shutdown_relay").Destroy()
            Entities.FindByName(null, "dummy_shoot_entry_door_clip").Destroy()
            // By deleting these doors players can glitch a trigger and make Wheatley trigger a privious line.
            // To solve this we detect when scanner_socket_new_turret_trigger doesn't exist and then we do something (Moja)
            Entities.FindByName(null, "control_room_blocking_doors").Destroy()
            Entities.FindByName(null, "control_room_blocking_doors").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(800, -2896, 7224), 20).Destroy()
            // We need to recreate this trigger because it destroys portals and sets up the next area (Moja)
            Entities.FindByClassnameNearest("trigger_once", Vector(2192, -6295.99, 6704), 20).Destroy()
            // Delete these because they close doors and delete parts of the map
            Entities.FindByClassnameNearest("trigger_once", Vector(-768, -7372, 6784), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-4080, -7232, 6328), 20).Destroy()
            // Fix dummy room door closing
            local ent = Entities.FindByName(null, "dummy_shoot_entry_door").__KeyValueFromString("targetname", "moja")
            EntFire("moja", "setanimation", "open", 2, null)
            TriggerOnceSP_A2_BTS4_1 <- true
            DisableLookDisablerSP_A2_BTS4 <- false

            TestingHackStart <- function() {
                printl("DOOR HACK START")
                WheatleyPlayerLookSP_A2_BTS4 <- false
            }
        }

        if (MSPostPlayerSpawn==true) {
            EntFireByHandle(Entities.FindByName(null, "@transition_script"), "RunScriptCode", "OnPostTransition()", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "entry_airlock_door-proxy"), "OnProxyRelay1", "", 1.5, null, null)
        }

        if (MSLoop==true) {
            TestingHackStart
            local p = null
            while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1689.0235595703, -7900.8461914062, 6707.0034179688), 78.400001525879*1.5)) {
                DisableLookDisablerSP_A2_BTS4 <- true
            }

            WheatleyPlayerLookSP_A2_BTS4 <- true
            if (DisableLookDisablerSP_A2_BTS4 == false) {
                // Make a custom trigger to disable player look
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1028.5295410156, -7103.0068359375, 6741.3315429688), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1028.5295410156, -7103.0068359375, 6741.3315429688), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1028.5295410156, -7103.0068359375, 6741.3315429688), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1403.9912109375, -7096.8754882812, 6690.7314453125), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1403.9912109375, -7096.8754882812, 6690.7314453125), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1403.9912109375, -7096.8754882812, 6690.7314453125), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1789.1419677734, -7122.5893554688, 6749.4721679688), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1789.1419677734, -7122.5893554688, 6749.4721679688), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1789.1419677734, -7122.5893554688, 6749.4721679688), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1788.701171875, -7474.5654296875, 6731.2202148438), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1788.701171875, -7474.5654296875, 6731.2202148438), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(-1788.701171875, -7474.5654296875, 6731.2202148438), 163.19999694824*1.5)) {
                    WheatleyPlayerLookSP_A2_BTS4 <- false
                }
            }

            // On trigger hit, smash the door 18 seconds later
            if (TriggerOnceSP_A2_BTS4_1==true) {
                if (!Entities.FindByName(null, "wheatley_scanner_intro_vcd_trigger")) {
                    printl("Wheatley Sequance Started")
                    EntFire("wheatley_start_smash_window_relay", "trigger", "", 18, null)
                    EntFire("@glados", "RunScriptCode", "FactoryControlRoomHackSuccess()", 18, null)
                    TriggerOnceSP_A2_BTS4_1 <- false
                }
            }

            // Make Wheatley look at nearest player (We need wheatley to light the way for the player but since he's looking at them on loop he can't) (Moja)
            if (WheatleyPlayerLookSP_A2_BTS4==true) {
                try {
                    local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
                    EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
                } catch(exception) {}
            }

            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-4080, -7232, 6328), 64)) {
                 
                SendToConsole("changelevel sp_a2_bts5")
            }
        }
    }

    //## SP_A2_BTS5 ##//
    // We need to do something with the elevator or use teleports so all players can get up (Moja)
    // We also need to polish the point_viewcontrol somehow to better funnel the players into the vactube (Moja)
    if (GetMapName()=="sp_a2_bts5") {
        if (MSInstantRun==true) {
            // Open the airlock areaportal on mapspawn
            EntFireByHandle(Entities.FindByName(null, "airlock_door_01_areaportal"), "Open", "", 0, null, null)
            // Set sv_allow_mobile_portals to 1 and set up the changelevel command entity
            Entities.CreateByClassname("point_servercommand").__KeyValueFromString("targetname", "Sp_A2_Bts5ServerCommand")
            EntFire("Sp_A2_Bts5ServerCommand", "command", "sv_allow_mobile_portals 1", 1, null)
            // Set the viewcontrol parent first stop to a our pathtrack
            EntFireByHandle(Entities.FindByName(null, "podtrain_player"), "target", "tube_path1", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "airlock_door_01-close_door_fast").Destroy()
            Entities.FindByName(null, "lock_door_trigger").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(3794.06, -1727.98, 3488), 20).Destroy()
            OnlyOnceSp_A2_Bts5 <- true
            OnlyOnceTPSP_A2_BTS5 <- true
            LoopEnablerSP_A2_BTS5 <- false
        }

        if (MSPostPlayerSpawn==true) {
            Entities.FindByName(null, "airlock_door_01_areaportal").__KeyValueFromString("targetname", "moja")
            EntFireByHandle(Entities.FindByName(null, "@transition_script"), "RunScriptCode", "OnPostTransition()", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "exit_airlock_door-proxy"), "OnProxyRelay1", "", 0.5, null, null)
        }

        if (MSLoop==true) {
            local p = null
            while (p = Entities.FindByClassnameWithin(p, "npc_portal_turret_floor", Vector(2594.6696777344, 1760.8935546875, 3943.775390625), 400)) {
                p.SetOrigin(Vector(p.GetOrigin().x, (p.GetOrigin().y-24)*10*TickSpeed, (p.GetOrigin().z-6)*10*TickSpeed))
            }

            // Find all players within
            if (LoopEnablerSP_A2_BTS5==false) {
                local p = null
                while (p = Entities.FindByClassnameWithin(p, "player", Vector(2944, 942, 4418), 80)) {
                    LoopEnablerSP_A2_BTS5 <- true
                }
            }

            // Teleport everyone on the ground to the elevator
            if (LoopEnablerSP_A2_BTS5==true) {
                // Find all players under the elevator
                local p = null
                while (p = Entities.FindByClassname(p, "player")) {
                    if (p.GetOrigin().z<=4100) {
                        p.SetOrigin(Vector(2929, 942, 4418))
                        p.SetAngles(0, 180, 0)
                        p.SetVelocity(Vector(0, 0, 0))
                    }
                }
            }

            // Make the elevator go up with the players in it
            if (OnlyOnceTPSP_A2_BTS5==true) {
                if (!Entities.FindByClassnameNearest("trigger_once", Vector(2941.5, 944, 3662), 20)) {
                    printl("Triggered")
                    //Find all players
                    local p = null
                    while (p = Entities.FindByClassname(p, "player")) {
                        p.SetOrigin(Vector(2944, 942, 3700))
                        p.SetAngles(0, 180, 0)
                        p.SetVelocity(Vector(0, 0, 0))
                    }
                    OnlyOnceTPSP_A2_BTS5 <- false
                }
            }

            if (OnlyOnceSp_A2_Bts5==true) {
                if (!Entities.FindByName(null, "exit_tube_1_exit_trigger")) {
                    printl("Suction viewcontrol activated")
                    // Sp_A2_Bts5 viewcontrol
                    Sp_A2_Bts5Viewcontrol <- Entities.CreateByClassname("point_viewcontrol_multiplayer")
                    Sp_A2_Bts5Viewcontrol.__KeyValueFromString("target_team", "-1")
                    Sp_A2_Bts5Viewcontrol.__KeyValueFromString("fov", "100")
                    Sp_A2_Bts5Viewcontrol.__KeyValueFromString("targetname", "Sp_A2_Bts5Viewcontrol")
                    Sp_A2_Bts5Viewcontrol.SetOrigin(Vector(2285, 512, 4508))
                    EntFire("Sp_A2_Bts5Viewcontrol", "setparent", "podtrain_player", 0, null)
                    Sp_A2_Bts5Viewcontrol.SetAngles(0, 180, 0)
                    EntFire("Sp_A2_Bts5Viewcontrol", "enable", "", 0, null)

                    local tube_path1 = Entities.CreateByClassname("path_track")
                    tube_path1.__KeyValueFromString("targetname", "tube_path1")
                    tube_path1.__KeyValueFromString("target", "tube_path2")
                    tube_path1.__KeyValueFromString("orientationtype", "0")

                    EntFire("Sp_A2_Bts5ServerCommand", "command", "echo Changing level...", 2, null)
                    EntFire("Sp_A2_Bts5ServerCommand", "command", "changelevel sp_a2_bts6", 2, null)

                    local p = null
                    while (p = Entities.FindByClassname(p, "player")) {
                        p.SetOrigin(Vector(-1964, 331, -2479))
                    }

                    OnlyOnceSp_A2_Bts5 <- false
                }
            }
            // Make Wheatley look at nearest player (We need wheatley to light the way for the player but since he's looking at them on loop he can't) (Moja)
            try {
                local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "spherebot_1_bottom_swivel_1").GetOrigin(), 10000)
                EntFireByHandle(Entities.FindByName(null, "spherebot_1_bottom_swivel_1"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
            } catch(exception) {}
        }
    }

    //## SP_A2_BTS6 ##//
    if (GetMapName()=="sp_a2_bts6") {
        if (MSInstantRun==true) {
            // Set up the changelevel command entity
            Entities.CreateByClassname("point_servercommand").__KeyValueFromString("targetname", "Sp_A2_Bts6ServerCommand")
            // Destroy objects
            Entities.FindByName(null, "tube_ride_start_relay").Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            printl("Ran")
            // Fire every single event in the map
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_1"), "SetAnimation", "bts6_A5", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_2"), "SetAnimation", "bts6_A4", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_3"), "SetAnimation", "bts6_A3", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_4"), "SetAnimation", "bts6_A2", 0.6, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_ride_chell_animation"), "SetAnimationNoReset", "chell_bts6", 2, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_ride_viewproxy"), "Enable", "", 2, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_ride_wheatley_animation"), "SetAnimationNoReset", "wheatley_bts6", 2, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_5"), "SetAnimation", "bts6_A1", 2.8, null, null)
            EntFireByHandle(Entities.FindByName(null, "@glados"), "RunScriptCode", "GladosPlayVcd(392)", 3, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_6"), "SetAnimation", "bts6_A1", 4, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_7"), "SetAnimation", "bts6_A1", 5, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_8"), "SetAnimation", "bts6_A2", 7, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_9"), "SetAnimation", "bts6_A1", 9, null, null)
            EntFireByHandle(Entities.FindByName(null, "@sphere"), "DisableFlashlight", "", 10, null, null)
            EntFireByHandle(Entities.FindByName(null, "shadowed_light_01"), "TurnOn", "", 10.1, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_main_prop_10"), "SetAnimation", "bts6_A2", 12, null, null)
            EntFireByHandle(Entities.FindByName(null, "shadowed_light_02"), "TurnOn", "", 18, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_loopy_start"), "Trigger", "", 18, null, null)
            EntFireByHandle(Entities.FindByName(null, "@cube_kill_rl"), "Trigger", "", 20, null, null)
            EntFireByHandle(Entities.FindByName(null, "tuberide_section_1_areaportal_1"), "Close", "", 20, null, null)
            EntFireByHandle(Entities.FindByName(null, "tuberide_section_1_areaportal_1_blackbrush"), "Enable", "", 20, null, null)
            EntFireByHandle(Entities.FindByName(null, "@glados"), "RunScriptCode", "GladosPlayVcd(393)", 29, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_straight_start"), "Trigger", "", 32, null, null)
            EntFireByHandle(Entities.FindByName(null, "tube_collision_start"), "Trigger", "", 36.75, null, null)
            EntFireByHandle(Entities.FindByName(null, "shadowed_light_03"), "TurnOn", "", 37, null, null)

            // Sp_A2_Bts6 viewcontrol creation
            Sp_A2_Bts6Viewcontrol <- Entities.CreateByClassname("point_viewcontrol_multiplayer")
            Sp_A2_Bts6Viewcontrol.__KeyValueFromString("targetname", "Sp_A2_Bts6Viewcontrol")
            Sp_A2_Bts6Viewcontrol.__KeyValueFromString("target_team", "-1")
            Sp_A2_Bts6Viewcontrol.SetOrigin(Entities.FindByName(null, "tube_ride_chell_proxy").GetOrigin())
            Sp_A2_Bts6Viewcontrol.SetAngles(270, 0, 0)
            EntFire("Sp_A2_Bts6Viewcontrol", "setparent", "tube_ride_chell_proxy", 0, null)
            EntFire("Sp_A2_Bts6Viewcontrol", "setparentattachment", "chell_bts6_attach", 0, null)
            EntFire("Sp_A2_Bts6Viewcontrol", "enable", "", 0, null)
            EntFire("Sp_A2_Bts6Viewcontrol", "disable", "", 50.66, null)

            EntFire("Sp_A2_Bts6ServerCommand", "command", "echo Changing level...", 51, null)
            EntFire("Sp_A2_Bts6ServerCommand", "command", "changelevel sp_a2_core", 51, null)
        }
    }

    //## SP_A3_00 ##//
    if (GetMapName()=="sp_a3_00") {
        if (MSInstantRun==true) {
            Entities.CreateByClassname("point_servercommand").__KeyValueFromString("targetname", "Sp_A3_00ServerCommand")
            printl(Entities.FindByName(null, "@environment_mines_fog").__KeyValueFromString("fogmaxdensity", "1"))
            Entities.FindByName(null, "@environment_mines_fog").__KeyValueFromString("fogend", "1")
            Entities.FindByName(null, "@environment_bottomless_pit_falling_fog").__KeyValueFromString("farz", "0")
            Entities.FindByName(null, "potatos_prop").__KeyValueFromString("solid", "0")
            // Destroy objects
            Entities.FindByClassnameNearest("logic_auto", Vector(144, -4048, 64), 20).Destroy()
            local ent = null
            while (ent = Entities.FindByClassname(ent, "trigger_push")) {
                ent.Destroy()
            }
        }

        if (MSPostPlayerSpawn==true) {
            EntFireByHandle(Entities.FindByName(null, "player_looktarget"), "SetParent", "!player", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "potatos_tank"), "SetTargetEntity", "player_looktarget", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "shaft_section_0"), "StartForward", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "shaft_section_1"), "StartForward", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "lift_mover"), "Open", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "ambient_sp_a3_01_b1"), "PlaySound", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "potatos_relay"), "Trigger", "", 3, null, null)
            EntFireByHandle(Entities.FindByName(null, "potatos_train"), "StartForward", "", 4, null, null)

            EntFire("Sp_A3_00ServerCommand", "command", "echo Changing level...", 76, null)
            EntFire("Sp_A3_00ServerCommand", "command", "changelevel sp_a3_01", 76, null)
        }

        if (MSLoop==true) {
            // Make POTATOS tank point at nearest player
            try {
                local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "potatos_tank").GetOrigin(), 10000)
                EntFireByHandle(Entities.FindByName(null, "potatos_tank"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
            } catch(exception) {}
        }
    }

    //## SP_A3_01 ##//
    if (GetMapName()=="sp_a3_01") {
        if (MSInstantRun==true) {
            // Here if we need to ent_fire something
            //EntFireByHandle(Entities.FindByName(null, "NAME"), "ACTION", "VALUE", DELAYiny, ACTIVATOR, CALLER)
            // Destroy objects
            Entities.FindByName(null, "transition_trigger").Destroy()
            Entities.FindByClassnameNearest("logic_auto", Vector(-10304, 2544, 112), 20).Destroy()
            OnlyOnceSp_A3_01 <- true
        }

        if (MSPostPlayerSpawn==true) {
            EntFireByHandle(Entities.FindByName(null, "global_ents-proxy"), "OnProxyRelay8", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "knockout_start"), "Trigger", "", 1, null, null)

            printl("Ran")
            Sp_A3_01Viewcontrol <- Entities.CreateByClassname("point_viewcontrol_multiplayer")
            Sp_A3_01Viewcontrol.__KeyValueFromString("targetname", "Sp_A3_01Viewcontrol")
            Sp_A3_01Viewcontrol.__KeyValueFromString("target_team", "-1")
            Sp_A3_01Viewcontrol.SetOrigin(Entities.FindByName(null, "knockout-viewcontroller").GetOrigin())
            Sp_A3_01Viewcontrol.SetAngles(0, 270, 0)
            EntFire("Sp_A3_01Viewcontrol", "setparent", "knockout-viewcontroller", 0, null)
            EntFire("Sp_A3_01Viewcontrol", "setparentattachment", "knockout-viewcontroller", 0, null)
            EntFire("Sp_A3_01Viewcontrol", "enable", "", 0, null)
            EntFire("Sp_A3_01ViewcontrolTele", "disable", "", 13, null)
            EntFire("Sp_A3_01Viewcontrol", "addoutput", "targetname Sp_A3_01ViewcontrolTele", 0.25, null)
            EntFire("Sp_A3_01ViewcontrolTele", "addoutput", "targetname Sp_A3_01ViewcontrolDone", 13.30, null)
        }

        if (MSLoop==true) {

            if (Entities.FindByName(null, "Sp_A3_01ViewcontrolTele")) {
                local p = null
                while (p = Entities.FindByClassname(p, "player")) {
                    p.SetOrigin(Vector(-162, -1966, 20))
                }
            }

            if (OnlyOnceSp_A3_01 == true) {
                if (Entities.FindByName(null, "Sp_A3_01ViewcontrolDone")) {
                    local p = null
                    while (p = Entities.FindByClassname(p, "player")) {
                        p.SetOrigin(Vector(-720, -1852, 10))
                        p.SetAngles(0, 90, 0)
                        Entities.FindByName(null, "knockout-viewcontroller-prop").Destroy()
                        Entities.FindByName(null, "knockout-portalgun").Destroy()
                    }
                    OnlyOnceSp_A3_01 <- false
                }
            }

            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(6016, 4496, -448), 100)) {
                 
                SendToConsole("changelevel sp_a3_03")
            }
        }
    }

    //## SP_A3_03 ##//
    if (GetMapName()=="sp_a3_03") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "pumproom_door_bottom_prop").__KeyValueFromString("targetname", "moja1")
            Entities.FindByName(null, "pumproom_door_bottom_portal").__KeyValueFromString("targetname", "moja2")
            // Here if we need to ent_fire something
            EntFireByHandle(Entities.FindByName(null, "pumproom_door_bottom_button"), "addoutput", "OnPressed moja1:SetAnimation:open", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "moja2"), "Open", "", 1, null, null)
            // Destroy objects
            Entities.FindByName(null, "fade_to_death-proxy").Destroy()
            Entities.FindByName(null, "main_elevator_bottom_clipbrush").Destroy()
            Entities.FindByName(null, "silent_fizzler").Destroy()
            Entities.FindByName(null, "@transition_from_map").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-6080, -2812, -5160), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {

        }

        if (MSOnPlayerJoin==true) {
            // Find all players
            local p = null
            while (p = Entities.FindByClassname(p, "player")) {
                EntFireByHandle(clientcommand, "Command", "r_flashlightbrightness 1", 0, p, p)
                EntFireByHandle(p, "setfogcontroller", "@environment_lake_fog", 0, null, null)
            }
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-3631, 1284, -2100), 100)) {
                 
                SendToConsole("changelevel sp_a3_jump_intro")
            }
        }
    }

    //## SP_A3_JUMP_INTRO ##//
    if (GetMapName()=="sp_a3_jump_intro") {
        if (MSInstantRun==true) {
            // Here if we need to ent_fire something
            //EntFireByHandle(Entities.FindByName(null, "NAME"), "ACTION", "VALUE", DELAYiny, ACTIVATOR, CALLER)
            // Destroy objects
            Entities.FindByName(null, "fade_to_death-proxy").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-8880, 2096, -412), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-676, 896, 448), 20).Destroy()
            OnlyOnceSp_A3_Jump_Intro <- true
        }

        if (MSPostPlayerSpawn==true) {
            EntFireByHandle(Entities.FindByName(null, "InstanceAuto12-entrance_lift_train"), "StartForward", "", 2, null, null)
            OnlyOnceSp_A3_Jump_Intro <- false
        }

        if (MSLoop==true) {
            if (OnlyOnceSp_A3_Jump_Intro == true) {
                local p = null
                while (p = Entities.FindByClassname(p, "player")) {
                    p.SetOrigin(Vector(-8880, 2096, -458))
                }
            }

            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-668, 2080, 2314), 100)) {
                 
                SendToConsole("changelevel sp_a3_bomb_flings")
            }
        }
    }

    //## SP_A3_BOMB_FLINGS ##//
    if (GetMapName()=="sp_a3_bomb_flings") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "InstanceAuto8-entrance_lift_train"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "fade_to_death-proxy").Destroy()
        }

        if (MSPostPlayerSpawn==true) {

        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-256, 1570, 1288), 100)) {
                 
                SendToConsole("changelevel sp_a3_crazy_box")
            }
        }
    }

    //## SP_A3_CRAZY_BOX ##//
    // What do we do if the players vaporize the box?
    if (GetMapName()=="sp_a3_crazy_box") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "InstanceAuto17-entrance_lift_train"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "fade_to_death").Destroy()
            Entities.FindByName(null, "AutoInstance1-door_close").Destroy()
            Entities.FindByName(null, "AutoInstance1-door_pushers").Destroy()
            Entities.FindByName(null, "AutoInstance1-door_pushers").Destroy()
            // We need to add a trigger to the crazy box test that plays ambient_sp_a3_crazy_box_b2 (Moja)
            Entities.FindByClassnameNearest("trigger_once", Vector(144, -1280, 1600), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(200, -1272, 1600), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {

        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(640, 174, 2740), 100)) {
                 
                SendToConsole("changelevel sp_a3_transition01")
            }
        }
    }

    //## SP_A3_TRANSITION01 ##//
    if (GetMapName()=="sp_a3_transition01") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "InstanceAuto2-entrance_lift_train"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "fall_death_fade").Destroy()
            Entities.FindByName(null, "pumproom_door_bottom_trigger").Destroy()
            Entities.FindByName(null, "pumproom_door_top_prop").__KeyValueFromString("targetname", "moja1")
            Entities.FindByName(null, "pumproom_portal_top").__KeyValueFromString("targetname", "moja2")
            // Here if we need to ent_fire something
            EntFireByHandle(Entities.FindByName(null, "pumproom_door_top_button"), "addoutput", "OnPressed moja1:SetAnimation:open", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "moja2"), "Open", "", 1, null, null)
        }

        if (MSPostPlayerSpawn==true) {
            Entities.FindByName(null, "officedoor_4").__KeyValueFromString("targetname", "moja3")
        }

        if (MSOnPlayerJoin==true) {
            // Find all players
            local p = null
            while (p = Entities.FindByClassname(p, "player")) {
                EntFireByHandle(clientcommand, "Command", "r_flashlightbrightness 1", 0, p, p)
                EntFireByHandle(p, "setfogcontroller", "@environment_lake_fog", 0, null, null)
            }
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-2048, -130, -3750), 100)) {
                 
                SendToConsole("changelevel sp_a3_speed_ramp")
            }
        }
    }

    //## SP_A3_SPEED_RAMP ##//
    if (GetMapName()=="sp_a3_speed_ramp") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "InstanceAuto20-entrance_lift_train"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "fade_to_death-proxy").Destroy()
            Entities.FindByName(null, "fade_to_death-fade_to_death").Destroy()
        }

        if (MSPostPlayerSpawn==true) {

        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1232, -642, 962), 100)) {
                 
                SendToConsole("changelevel sp_a3_speed_flings")
            }
        }
    }

    //## SP_A3_SPEED_FLINGS ##//
    if (GetMapName()=="sp_a3_speed_flings") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "InstanceAuto6-entrance_lift_train"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "fade_to_death-proxy").Destroy()
            Entities.FindByName(null, "fade_to_death-fade_to_death").Destroy()
        }

        if (MSPostPlayerSpawn==true) {

        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(396, 1152, 656), 100)) {
                 
                SendToConsole("changelevel sp_a3_portal_intro")
            }
        }
    }

    //## SP_A3_PORTAL_INTRO ##//
    if (GetMapName()=="sp_a3_portal_intro") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "1970s_door1door_lower").__KeyValueFromString("targetname", "moja1")
            Entities.FindByName(null, "1970s_door1door_upper").__KeyValueFromString("targetname", "moja2")
            Entities.FindByName(null, "1970s_door_1_areaportal").__KeyValueFromString("targetname", "moja3")
            Entities.FindByName(null, "1970s_door2_door_lower").__KeyValueFromString("targetname", "moja4")
            Entities.FindByName(null, "1970s_door2_door_upper").__KeyValueFromString("targetname", "moja5")
            Entities.FindByName(null, "1970s_door_2_areaportal").__KeyValueFromString("targetname", "moja6")
            Entities.FindByName(null, "bowl_areaportal").__KeyValueFromString("targetname", "moja7")
            Entities.FindByName(null, "paint_sprayer_2").__KeyValueFromString("targetname", "moja8")
            // Here if we need to ent_fire something
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(2505.95, -48, -2384), 20), "addoutput", "OnTrigger moja4:Open", 1, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(2505.95, -48, -2384), 20), "addoutput", "OnTrigger moja5:Open", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "sphere_entrance_lift_train_path_2"), "addoutput", "OnPass moja8:Start", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "moja3"), "Open", "", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "moja6"), "Open", "", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "moja7"), "Open", "", 1, null, null)
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "entrance_lift_train"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "abyss_loadsaved").Destroy()
            Entities.FindByName(null, "bowl_areaportal_blackbrush").Destroy()
            Entities.FindByName(null, "damaged_sphere_door_3-door_close").Destroy()
            Entities.FindByName(null, "damaged_sphere_door_4-door_close").Destroy()
            Entities.FindByName(null, "liftshaft_entrance_door-door_close").Destroy()
            Entities.FindByName(null, "transition_trigger").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(2400, 1360, -1920), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(2416, -128, 640.01), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {

        }

        if (MSLoop==true) {
            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(3839.99, 348.8, 5674.67), 50)) {
                 
                SendToConsole("changelevel sp_a3_end")
            }
        }
    }

    //## SP_A3_END ##//
    if (GetMapName()=="sp_a3_end") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "entrance_door_prop").__KeyValueFromString("targetname", "moja1")
            Entities.FindByName(null, "paint_trickle_blue_1").__KeyValueFromString("targetname", "moja2")
            Entities.FindByName(null, "paint_trickle_white_1").__KeyValueFromString("targetname", "moja3")
            Entities.FindByName(null, "paint_trickle_orange_1").__KeyValueFromString("targetname", "moja4")
            Entities.FindByName(null, "paint_trickle_blue_2").__KeyValueFromString("targetname", "moja5")
            Entities.FindByName(null, "paint_trickle_blue_2").__KeyValueFromString("targetname", "moja5")
            Entities.FindByName(null, "paint_trickle_white_2").__KeyValueFromString("targetname", "moja6")
            // Here if we need to ent_fire something
            EntFireByHandle(Entities.FindByName(null, "entrance_door_button"), "addoutput", "OnPressed moja1:SetAnimation:open", 1, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(192, 256, -3336), 20), "addoutput", "OnTrigger moja3:Start", 1, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(192, 256, -3336), 20), "addoutput", "OnTrigger moja4:Start", 1, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(192, 256, -3336), 20), "addoutput", "OnTrigger moja5:Start", 1, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(-552, 256, -2200), 20), "addoutput", "OnTrigger moja6:Start", 1, null, null)
            // Fix func_portal_detectors
            local ent = null
            while (ent = Entities.FindByClassname(ent, "func_portal_detector")) {
                ent.__KeyValueFromString("CheckAllIDs", "1")
            }
            // Destroy objects
            Entities.FindByName(null, "fade_to_death").Destroy()
        }

        if (MSPostPlayerSpawn==true) {

        }

        if (MSOnPlayerJoin==true) {
            // Find all players
            local p = null
            while (p = Entities.FindByClassname(p, "player")) {
                EntFireByHandle(clientcommand, "Command", "r_flashlightbrightness 1", 0, p, p)
                EntFireByHandle(p, "setfogcontroller", "@environment_lake_fog", 0, null, null)
            }
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-1540, -830, 3840), 50)) {
                 
                SendToConsole("changelevel sp_a4_intro")
            }
        }
    }

    //## SP_A4_INTRO ##//
    // Make prop_dy dizove (Moja)
    if (GetMapName()=="sp_a4_intro") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "@exit_door1-proxy").__KeyValueFromString("targetname", "moja1")
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "button_1_pressed"), "addoutput", "OnTrigger moja1:OnProxyRelay2:open", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "button_1_unpressed"), "addoutput", "OnTrigger moja1:OnProxyRelay1:close", 1, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "@entrance_door1-close_door_rl").Destroy()
            Entities.FindByName(null, "room2_wall_close").Destroy()
            Entities.FindByName(null, "room2a_wall_close").Destroy()
            Entities.FindByName(null, "test2_end_trigger").Destroy()
            Entities.FindByName(null, "@exit_door-close_door_rl").Destroy()
            OnlyOnceSpA4Intro <- true
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Change ClosedBetaTestingBox Names ;)
            local ent = null
            while (ent = Entities.FindByClassnameWithin(ent, "prop_monster_box", Vector(-58.406547546387, -59.558124542236, 187.5777130127), 400)) {
                ent.__KeyValueFromString("targetname", "moja2")
            }
            if (OnlyOnceSpA4Intro==true) {
                if (!Entities.FindByName(null, "room2_wall_open_trigger")) {
                    printl("(P2:MM): Elevator viewcontrol activated!")
                    // Elevator viewcontrol
                    Entities.FindByName(null, "@exit_door2-close_door_rl").__KeyValueFromString("targetname", "moja3")

                    EntFireByHandle(Entities.FindByName(null, "button_2_unpressed"), "addoutput", "OnTrigger moja3:Trigger", 0, null, null)

                    OnlyOnceSpA4Intro <- false
                }
            }
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(3136, -128, 914), 50)) {
                 
                SendToConsole("changelevel sp_a4_tb_intro")
            }
        }
    }

    //## SP_A4_TB_INTRO ##//
    if (GetMapName()=="sp_a4_tb_intro") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(2368, 736, 72), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(2368, 736, 64), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(2784, 736, 432), 50)) {
                 
                SendToConsole("changelevel sp_a4_tb_trust_drop")
            }
        }
    }

    //## SP_A4_TB_TRUST_DROP ##//
    if (GetMapName()=="sp_a4_tb_trust_drop") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "music1").__KeyValueFromString("targetname", "moja")
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(320, 1456, 832), 20), "addoutput", "OnTrigger moja:PlaySound", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "fall_fade").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(624, 448, 960), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(704, 448, 968), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1120, 448, 1328), 50)) {
                 
                SendToConsole("changelevel sp_a4_tb_wall_button")
            }
        }
    }

    //## SP_A4_TB_WALL_BUTTON ##//
    if (GetMapName()=="sp_a4_tb_wall_button") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "fall_fade").Destroy()
            Entities.FindByClassnameNearest("trigger_multiple", Vector(736, 960, 160), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(864, 960, 168), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1280, 960, 528), 50)) {
                 
                SendToConsole("changelevel sp_a4_tb_polarity")
            }
        }
    }

    //## SP_A4_TB_POLARITY ##//
    if (GetMapName()=="sp_a4_tb_polarity") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "fall_fade").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-128, -208, 288), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-128, -288, 296), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-128, -704, 656), 50)) {
                 
                SendToConsole("changelevel sp_a4_tb_catch")
            }
        }
    }

    //## SP_A4_TB_CATCH ##//
    if (GetMapName()=="sp_a4_tb_catch") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "@exit_door-proxy").__KeyValueFromString("targetname", "moja")
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "music.sp_a4_tb_catch_b0"), "StopSound", "", 0.5, null, null)
            EntFireByHandle(Entities.FindByName(null, "music.sp_a4_tb_catch_b0"), "PlaySound", "", 1, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("prop_floor_button", Vector(704, 1184, 299), 20), "addoutput", "OnPressed moja:OnProxyRelay2", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("prop_floor_button", Vector(704, 1184, 299), 20), "addoutput", "OnUnPressed moja:OnProxyRelay1", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("prop_floor_button", Vector(704, 1184, 299), 20), "addoutput", "OnPressed @glados:RunScriptCode:PuzzleCompleted()", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
            Entities.FindByName(null, "fall_fade").Destroy()
            Entities.FindByName(null, "puzzle_completed_relay").Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1440, 896, 688), 50)) {
                 
                SendToConsole("changelevel sp_a4_stop_the_box")
            }
        }
    }

    //## SP_A4_STOP_THE_BOX ##//
    if (GetMapName()=="sp_a4_stop_the_box") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "music.sp_a4_stop_the_box_b1").__KeyValueFromString("targetname", "moja")
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "movelinear_light_track"), "addoutput", "OnFullyOpen moja:PlaySound", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "door_0-close_door_rl").Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(896, -800, 1296), 50)) {
                 
                SendToConsole("changelevel sp_a4_laser_catapult")
            }
        }
    }

    //## SP_A4_LASER_CATAPULT ##//
    if (GetMapName()=="sp_a4_laser_catapult") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "@entry_door-close_door_rl").Destroy()
            Entities.FindByName(null, "@exit_door-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(624, -512, 576), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(1248, -512, 912), 50)) {
                 
                SendToConsole("changelevel sp_a4_laser_platform")
            }
        }
    }

    //## SP_A4_LASER_PLATFORM ##//
    if (GetMapName()=="sp_a4_laser_platform") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "entrance_door-close_door_rl").Destroy()
            Entities.FindByName(null, "fall_fade").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(4088, -528, -2080), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(3456, -1056, -2648), 200)) {
                 
                SendToConsole("changelevel sp_a4_speed_tb_catch")
            }
        }
    }

    //## SP_A4_SPEED_TB_CATCH ##//
    // Music doesn't play at the end (Moja)
    if (GetMapName()=="sp_a4_speed_tb_catch") {
        if (MSInstantRun==true) {
            // Here if we need to ent_fire something
            //EntFireByHandle(Entities.FindByName(null, "NAME"), "ACTION", "VALUE", DELAYiny, ACTIVATOR, CALLER)
            // Destroy objects
            Entities.FindByName(null, "fall_fade").Destroy()
            Entities.FindByName(null, "exit_door-close_door_rl").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-736, 1572, -128), 20).Destroy()
            local ent = null
            while (ent = Entities.FindByClassname(ent, "func_portal_detector")) {
                ent.__KeyValueFromString("CheckAllIDs", "1")
            }
        }

        if (MSPostPlayerSpawn==true) {

        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-2240, -208, 400), 50)) {
                 
                SendToConsole("changelevel sp_a4_jump_polarity")
            }
        }
    }

    //## SP_A4_JUMP_POLARITY ##//
    if (GetMapName()=="sp_a4_jump_polarity") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "antechamber_exit").__KeyValueFromString("targetname", "moja1")
            Entities.FindByName(null, "antechamber_areaportal").__KeyValueFromString("targetname", "moja2")
            Entities.FindByName(null, "antechamber_door_sound").__KeyValueFromString("targetname", "moja3")
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "moja1"), "SetAnimation", "idleclose", 1, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(2336, -64, 192), 20), "addoutput", "OnStartTouch moja1:SetAnimation:Open", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "@entry_door-close_door_rl").Destroy()
            Entities.FindByName(null, "fall_fade").Destroy()
            Entities.FindByName(null, "antechamber-proxy").Destroy()
            // Teleport here, what should we do with players still in the test chamber?
            Entities.FindByClassnameNearest("trigger_once", Vector(928.01, 2328, 448), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Elevator changelevel
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(2560, -3072, 768), 50)) {
                 
                SendToConsole("changelevel sp_a4_finale1")
            }
        }
    }

    //## SP_A4_FINALE1 ##//
    if (GetMapName()=="sp_a4_finale1") {
        if (MSInstantRun==true) {
            // Make elevator start moving on level load
            EntFireByHandle(Entities.FindByName(null, "arrival_elevator-elevator_1"), "StartForward", "", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "entrance_door-close_door_rl").Destroy()
            Entities.FindByName(null, "fall_fade").Destroy()
            Entities.FindByName(null, "final_door-close_door_fast").Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-10792, -2048.01, 144), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-12832, -3040, -112), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            NewApertureStartElevatorFixes()
        }

        if (MSLoop==true) {
            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-12832, -3040, -112), 100)) {
                 
                SendToConsole("changelevel sp_a4_finale2")
            }
        }
    }

    //## SP_A4_FINALE2 ##//
    if (GetMapName()=="sp_a4_finale2") {
        if (MSInstantRun==true) {
            Entities.FindByName(null, "portal_chamber_1").__KeyValueFromString("targetname", "moja1")
            Entities.FindByName(null, "portal_chamber_2").__KeyValueFromString("targetname", "moja2")
            Entities.FindByName(null, "areaportal_airlock_1").__KeyValueFromString("targetname", "moja3")
            Entities.FindByName(null, "portal_chamber_3").__KeyValueFromString("targetname", "moja4")
            Entities.FindByName(null, "portal_chamber_4").__KeyValueFromString("targetname", "moja5")
            Entities.FindByName(null, "areaportal_bts_door_2").__KeyValueFromString("targetname", "moja6")
            // Here if we need to ent_fire something
            EntFireByHandle(Entities.FindByName(null, "brush_movechamber_struts"), "SetParentAttachmentMaintainOffset", "a4_chamber_fx_A_attach1", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "lighting_chamber_struts"), "SetParentAttachmentMaintainOffset", "a4_chamber_fx_A_attach1", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "relay_hatch_release"), "addoutput", "OnTrigger moja1:Open::0.5", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "relay_hatch_release"), "addoutput", "OnTrigger moja2:Open::0.5", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(957.7, 720, -192), 20), "addoutput", "OnTrigger moja3:Open", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(11835.1, 11776, 8543.99), 20), "addoutput", "OnTrigger moja4:Open::0.5", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(11835.1, 11776, 8543.99), 20), "addoutput", "OnTrigger moja5:Open::0.5", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(-474.34, -1236.01, -448), 20), "addoutput", "OnTrigger moja6:Open", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "entrance_door-proxy").Destroy()
            Entities.FindByName(null, "fall_fade").Destroy()
            Entities.FindByName(null, "bts_door_1-close_door_fast").Destroy()
            Entities.FindByName(null, "bts_door_2-close_door_fast").Destroy()
            Entities.FindByClassnameNearest("logic_auto", Vector(3903, 902, -55), 20).Destroy()
            Entities.FindByClassnameNearest("trigger_once", Vector(-3152, -1928, -240), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            EntFireByHandle(Entities.FindByName(null, "entrance_door-open_door"), "Trigger", "", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "music01"), "PlaySound", "", 0, null, null)
        }

        if (MSLoop==true) {
            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-3152, -1928, -240), 100)) {
                 
                SendToConsole("changelevel sp_a4_finale3")
            }
        }
    }

    //## SP_A4_FINALE3 ##//
    // Wheatley crusher glitch (Moja)
    if (GetMapName()=="sp_a4_finale3") {
        if (MSInstantRun==true) {
            Entities.FindByClassnameNearest("prop_dynamic", Vector(736, -1832, 185), 20).__KeyValueFromString("targetname", "moja1")
            Entities.FindByName(null, "airlock_door2").__KeyValueFromString("targetname", "moja2")
            Entities.FindByName(null, "airlock_door2_brush").__KeyValueFromString("targetname", "moja3")
            Entities.FindByName(null, "airlock_door2_areaportal").__KeyValueFromString("targetname", "moja4")
            Entities.FindByName(null, "practice_bomb_timer").__KeyValueFromString("targetname", "moja5")
            Entities.FindByName(null, "areaportal_1").__KeyValueFromString("targetname", "moja6")
            Entities.FindByName(null, "light_shadowed_02").__KeyValueFromString("targetname", "moja7")
            // Here if we need to ent_fire something
            EntFireByHandle(Entities.FindByName(null, "light_dynamic_2nd_office"), "TurnOn", "", 1, null, null)
            EntFireByHandle(Entities.FindByName(null, "global_ents-proxy"), "OnProxyRelay16", "", 1, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(-32, -1032, 32), 20), "addoutput", "OnTrigger moja2:SetAnimation:vert_door_opening", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(-32, -1032, 32), 20), "addoutput", "OnTrigger moja3:Disable", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_once", Vector(-32, -1032, 32), 20), "addoutput", "OnTrigger moja4:Open", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "bomb_1_down_counter"), "addoutput", "OnHitMax moja5:Disable", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "bomb_1_button_relay"), "addoutput", "OnTrigger moja5:Disable", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "bomb_1_divert_down_relay"), "addoutput", "OnTrigger moja5:Enable::4.5", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "bomb_1_divert_up_relay"), "addoutput", "OnTrigger moja5:Enable::4.5", 0, null, null)
            EntFireByHandle(Entities.FindByName(null, "push_paint_platform"), "addoutput", "OnStartTouch moja7:TurnOn", 0, null, null)
            EntFireByHandle(Entities.FindByClassnameNearest("trigger_multiple", Vector(-960, 416, -256), 20), "addoutput", "OnStartTouch moja7:TurnOn", 0, null, null)
            // Destroy objects
            Entities.FindByName(null, "death_fade").Destroy()
            Entities.FindByName(null, "door_lair-close_door_fast").Destroy()
            Entities.FindByName(null, "transition_trigger").Destroy()
            Entities.FindByClassnameNearest("logic_auto", Vector(720, -2048, 152), 20).Destroy()
        }

        if (MSPostPlayerSpawn==true) {
            EntFireByHandle(Entities.FindByName(null, "entry_door-proxy"), "OnProxyRelay1", "", 0, null, null)
        }

        if (MSLoop==true) {
            // Make Wheatley look at nearest player
            try {
                local ClosestPlayerMain = Entities.FindByClassnameNearest("player", Entities.FindByName(null, "wheatley_screen-screen_tank").GetOrigin(), 10000)
                EntFireByHandle(Entities.FindByName(null, "wheatley_screen-screen_tank"), "SetTargetEntity", ClosestPlayerMain.GetName(), 0, null, null)
            } catch(exception) {}

            // Make our own changelevel trigger
            local p = null
            while(p = Entities.FindByClassnameWithin(p, "player", Vector(-616, 5376, 720), 200)) {
                 
                SendToConsole("changelevel sp_a4_finale4")
            }
        }
    }

    //## SP_A4_FINALE4 ##//
    if (GetMapName()=="sp_a4_finale4") {
        if (MSInstantRun==true) {
            // Here if we need to ent_fire something
            //EntFireByHandle(Entities.FindByName(null, "NAME"), "ACTION", "VALUE", DELAYiny, ACTIVATOR, CALLER)
            // Destroy objects
            //Entities.FindByName(null, "NAME").Destroy()
        }

        if (MSPostPlayerSpawn==true) {

        }

        if (MSLoop==true) {

        }
    }
